!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).thi=e.thi||{},e.thi.ng=e.thi.ng||{},e.thi.ng.api={}))}(this,(function(e){"use strict";const t=e=>null!=e&&"function"==typeof e.deref;var i,n;e.LogLevel=void 0,(i=e.LogLevel||(e.LogLevel={}))[i.FINE=0]="FINE",i[i.DEBUG=1]="DEBUG",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.SEVERE=4]="SEVERE",i[i.NONE=5]="NONE",e.GLType=void 0,(n=e.GLType||(e.GLType={}))[n.I8=5120]="I8",n[n.U8=5121]="U8",n[n.I16=5122]="I16",n[n.U16=5123]="U16",n[n.I32=5124]="I32",n[n.U32=5125]="U32",n[n.F32=5126]="F32";const r={[e.GLType.I8]:"i8",[e.GLType.U8]:"u8",[e.GLType.I16]:"i16",[e.GLType.U16]:"u16",[e.GLType.I32]:"i32",[e.GLType.U32]:"u32",[e.GLType.F32]:"f32"},o={i8:e.GLType.I8,u8:e.GLType.U8,u8c:e.GLType.U8,i16:e.GLType.I16,u16:e.GLType.U16,i32:e.GLType.I32,u32:e.GLType.U32,f32:e.GLType.F32,f64:void 0},s={u8:1,u8c:1,i8:1,u16:2,i16:2,u32:4,i32:4,f32:4,f64:8},l={f32:Float32Array,f64:Float64Array},a={i8:Int8Array,i16:Int16Array,i32:Int32Array},c={u8:Uint8Array,u8c:Uint8ClampedArray,u16:Uint16Array,u32:Uint32Array},u=Object.assign(Object.assign(Object.assign({},l),a),c),f=e=>{const t=r[e];return void 0!==t?t:e};const y=Symbol(),p=()=>{},h="enable",d="disable",L=(()=>{try{return"production"!==process.env.NODE_ENV||"1"===process.env.UMBRELLA_ASSERTS}catch(e){}return!1})()?(e,t="assertion failed")=>{if("function"==typeof e&&!e()||!e)throw new Error("function"==typeof t?t():t)}:p,E=Object.freeze({level:e.LogLevel.NONE,fine(){},debug(){},info(){},warn(){},severe(){}});const g=(e,t={})=>{const i=Reflect.ownKeys(e),n=Reflect.ownKeys(t),r=Symbol("isa");function o(t){for(let n of i){const i=Object.getOwnPropertyDescriptor(t.prototype,n);!i||i.configurable?Object.defineProperty(t.prototype,n,{value:e[n],writable:!0}):console.log(`not patching: ${t.name}.${n.toString()}`)}return Object.defineProperty(t.prototype,r,{value:!0}),t}for(let e of n)Object.defineProperty(o,e,{value:t[e],enumerable:t.propertyIsEnumerable(e)});return Object.defineProperty(o,Symbol.hasInstance,{value:e=>!!e[r]}),o},b=g({_enabled:!0,isEnabled(){return this._enabled},enable(){_(this,!0,h)},disable(){_(this,!1,d)},toggle(){return this._enabled?this.disable():this.enable(),this._enabled}}),_=(e,t,i)=>{e._enabled=t,e.notify&&e.notify({id:i,target:e})},T=(e,t)=>{if(e)for(let i,n=0,r=e.length;n<r;n++)if(i=e[n],i[0].call(i[1],t),t.canceled)return},v=g({addListener(e,t,i){let n=(this._listeners=this._listeners||{})[e];return!n&&(n=this._listeners[e]=[]),-1===this.__listener(n,t,i)&&(n.push([t,i]),!0)},removeListener(e,t,i){let n;if(!(n=this._listeners))return!1;const r=n[e];if(r){const o=this.__listener(r,t,i);if(-1!==o)return r.splice(o,1),!r.length&&delete n[e],!0}return!1},notify(e){let t;if(!(t=this._listeners))return!1;void 0===e.target&&(e.target=this),T(t[e.id],e),T(t["*"],e)},__listener(e,t,i){let n=e.length;for(;--n>=0;){const r=e[n];if(r[0]===t&&r[1]===i)break}return n}}),A=g({addWatch(e,t){return this._watches=this._watches||{},!this._watches[e]&&(this._watches[e]=t,!0)},removeWatch(e){if(this._watches)return!!this._watches[e]&&(delete this._watches[e],!0)},notifyWatches(e,t){if(!this._watches)return;const i=this._watches;for(let n in i)i[n](n,e,t)}});e.ConsoleLogger=class{constructor(t,i=e.LogLevel.FINE){this.id=t,this.level=i}fine(...t){this.level<=e.LogLevel.FINE&&this.log("FINE",t)}debug(...t){this.level<=e.LogLevel.DEBUG&&this.log("DEBUG",t)}info(...t){this.level<=e.LogLevel.INFO&&this.log("INFO",t)}warn(...t){this.level<=e.LogLevel.WARN&&this.log("WARN",t)}severe(...t){this.level<=e.LogLevel.SEVERE&&this.log("SEVERE",t)}log(e,t){console.log(`[${e}] ${this.id}:`,...t)}},e.DEFAULT_EPS=1e-6,e.EVENT_ALL="*",e.EVENT_DISABLE=d,e.EVENT_ENABLE=h,e.FLOAT_ARRAY_CTORS=l,e.GL2TYPE=r,e.IEnableMixin=b,e.INT_ARRAY_CTORS=a,e.INotifyMixin=v,e.IWatchMixin=A,e.NO_OP=p,e.NULL_LOGGER=E,e.SEMAPHORE=y,e.SIZEOF=s,e.TYPE2GL=o,e.TYPEDARRAY_CTORS=u,e.UINT_ARRAY_CTORS=c,e.asGLType=e=>{const t=o[e];return void 0!==t?t:e},e.asNativeType=f,e.assert=L,e.configurable=e=>function(t,i,n){n.configurable=e},e.deprecated=(e,t=console.log)=>function(i,n,r){const o=`${i.constructor.name}#${n.toString()}`,s=r.value;return L("function"==typeof s,`${o} is not a function`),r.value=function(){return t(`DEPRECATED ${o}: ${e||"will be removed soon"}`),s.apply(this,arguments)},r},e.deref=e=>t(e)?e.deref():e,e.exposeGlobal=(e,t,i=!1)=>{const n="undefined"!=typeof global?global:"undefined"!=typeof window?window:void 0;n&&(i||(()=>{try{return"production"!==process.env.NODE_ENV||"1"===process.env.UMBRELLA_GLOBALS}catch(e){}return!1})())&&(n[e]=t)},e.inotify_dispatch=T,e.intTypeForBits=e=>e>16?"i32":e>8?"i16":"i8",e.intTypeForSize=e=>e>=-128&&e<128?"i8":e>=-32768&&e<32768?"i16":"i32",e.isDeref=t,e.iterable=e=>g({*[Symbol.iterator](){yield*this[e]}}),e.mixin=g,e.nomixin=(e,t,i)=>{i.configurable=!1},e.sealed=e=>{Object.seal(e),Object.seal(e.prototype)},e.sizeOf=e=>s[f(e)],e.typedArray=function(e,...t){return new(u[f(e)])(...t)},e.typedArrayType=e=>{if(Array.isArray(e))return"f64";for(let t in u)if(e instanceof u[t])return t;return"f64"},e.uintTypeForBits=e=>e>16?"u32":e>8?"u16":"u8",e.uintTypeForSize=e=>e<=256?"u8":e<=65536?"u16":"u32",Object.defineProperty(e,"__esModule",{value:!0})}));