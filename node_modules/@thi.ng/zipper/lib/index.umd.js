!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@thi.ng/api"),require("@thi.ng/arrays"),require("@thi.ng/checks")):"function"==typeof define&&define.amd?define(["exports","@thi.ng/api","@thi.ng/arrays","@thi.ng/checks"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).thi=t.thi||{},t.thi.ng=t.thi.ng||{},t.thi.ng.zipper={}),t.thi.ng.api,t.thi.ng.arrays,t.thi.ng.checks)}(this,(function(t,e,n,s){"use strict";const i=(t,e,n,s,i=!1)=>({l:t,r:e,path:n,nodes:s,changed:i}),h=t=>t?Object.assign(Object.assign({},t),{changed:!0}):void 0;class r{constructor(t,e,n){this._node=t,this._ops=e,this._path=n}get isBranch(){return this._ops.branch(this._node)}get isFirst(){return!this.lefts}get isLast(){return!this.rights}get depth(){let t=0,e=this._path;for(;e;)t++,e=e.path;return t}get node(){return this._node}get children(){return this._ops.children(this._node)}get path(){return this._path?this._path.nodes:void 0}get lefts(){return this._path?this._path.l:void 0}get rights(){return this._path?this._path.r:void 0}get left(){const t=this._path,e=t&&t.l;return e&&e.length?new r(n.peek(e),this._ops,i(e.slice(0,e.length-1),[this._node].concat(t.r||[]),t.path,t.nodes,t.changed)):void 0}get right(){const t=this._path,e=t&&t.r;if(!e)return;const n=e.slice(1);return new r(e[0],this._ops,i((t.l||[]).concat([this._node]),n.length?n:void 0,t.path,t.nodes,t.changed))}get leftmost(){const t=this._path,e=t&&t.l;return e&&e.length?new r(e[0],this._ops,i(void 0,e.slice(1).concat([this._node],t.r||[]),t.path,t.nodes,t.changed)):this}get rightmost(){const t=this._path,e=t&&t.r;return e?new r(n.peek(e),this._ops,i((t.l||[]).concat([this._node],e.slice(0,e.length-1)),void 0,t.path,t.nodes,t.changed)):this}get down(){if(!this.isBranch)return;const t=this.children;if(!t)return;const e=this._path,n=t.slice(1);return new r(t[0],this._ops,i(void 0,n.length?n:void 0,e,e?e.nodes.concat([this._node]):[this._node]))}get up(){let t=this._path;const e=t&&t.nodes;if(!e)return;const s=n.peek(e);return t.changed?new r(this.newNode(s,(t.l||[]).concat([this._node],t.r||[])),this._ops,h(t.path)):new r(s,this._ops,t.path)}get root(){const t=this.up;return t?t.root:this._node}get prev(){let t=this.left;if(!t)return this.up;for(;;){const e=t.isBranch?t.down:void 0;if(!e)return t;t=e.rightmost}}get next(){if(this.isBranch)return this.down;let t=this.right;if(t)return t;let e=this;for(;;){const n=e.up;if(!n)return;if(t=n.right,t)return t;e=n}}replace(t){return new r(t,this._ops,h(this._path))}update(t,...e){return this.replace(t(this._node,...e))}insertLeft(t){this.ensureNotRoot();const e=this._path;return new r(this._node,this._ops,i(e.l?e.l.concat([t]):[t],e.r,e.path,e.nodes,!0))}insertRight(t){this.ensureNotRoot();const e=this._path;return new r(this._node,this._ops,i(e.l,[t].concat(e.r||[]),e.path,e.nodes,!0))}insertChild(t){return this.ensureBranch(),this.replace(this.newNode(this._node,[t,...this.children]))}appendChild(t){return this.ensureBranch(),this.replace(this.newNode(this._node,this.children.concat([t])))}remove(){this.ensureNotRoot();const t=this._path,e=t.l;if(e&&e.length){let s=new r(n.peek(e),this._ops,i(e.slice(0,e.length-1),t.r,t.path,t.nodes,!0));for(;;){const t=s.isBranch?s.down:void 0;if(!t)return s;s=t.rightmost}}return new r(this.newNode(n.peek(t.nodes),t.r||[]),this._ops,h(t.path))}newNode(t,e){return this._ops.factory(t,e)}ensureNotRoot(){e.assert(!!this._path,"can't insert at root level")}ensureBranch(){e.assert(this.isBranch,"can only insert in branches")}}const o=(t,e)=>new r(e,t);t.Location=r,t.arrayZipper=t=>o({branch:s.isArray,children:t=>t,factory:(t,e)=>e},t),t.zipper=o,Object.defineProperty(t,"__esModule",{value:!0})}));