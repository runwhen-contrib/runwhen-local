{"version":3,"file":"env.js","sourceRoot":"","sources":["../../../lib/util/exec/env.ts"],"names":[],"mappings":";;AAyCA,gDAqBC;AA9DD,gDAAmD;AAEnD,MAAM,YAAY,GAAG;IACnB,YAAY;IACZ,aAAa;IACb,UAAU;IACV,YAAY;IACZ,aAAa;IACb,UAAU;IACV,MAAM;IACN,MAAM;IACN,QAAQ;IACR,MAAM;IACN,aAAa;IACb,mBAAmB;IACnB,kBAAkB;IAClB,8BAA8B;IAC9B,yEAAyE;IACzE,cAAc;IACd,eAAe;IACf,qBAAqB;IACrB,yCAAyC;IACzC,cAAc;IACd,mBAAmB;IACnB,SAAS;IACT,cAAc;IACd,+CAA+C;IAC/C,4BAA4B;IAC5B,yBAAyB;IACzB,wBAAwB;IACxB,8BAA8B;IAC9B,oCAAoC;IACpC,eAAe;IACf,yBAAyB;IACzB,uBAAuB;IACvB,oBAAoB;IACpB,uBAAuB;IACvB,uBAAuB;IACvB,eAAe;CAChB,CAAC;AAEF,SAAgB,kBAAkB,CAChC,gBAA0B,EAAE;IAE5B,MAAM,GAAG,GAAsB,EAAE,CAAC;IAClC,IAAI,qBAAY,CAAC,GAAG,CAAC,cAAc,CAAC,EAAE,CAAC;QACrC,OAAO,EAAE,GAAG,OAAO,CAAC,GAAG,EAAE,CAAC;IAC5B,CAAC;IACD,MAAM,OAAO,GAAG,CAAC,GAAG,YAAY,EAAE,GAAG,aAAa,CAAC,CAAC;IACpD,OAAO,CAAC,OAAO,CAAC,CAAC,MAAM,EAAE,EAAE;QACzB,IAAI,OAAO,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,WAAW,EAAE,CAAC;YAC/C,GAAG,CAAC,MAAM,CAAC,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACpC,CAAC;IACH,CAAC,CAAC,CAAC;IAEH,sCAAsC;IACtC,KAAK,MAAM,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC;QAC3C,IAAI,+BAA+B,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC;YAC9C,GAAG,CAAC,GAAG,CAAC,GAAG,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QAC9B,CAAC;IACH,CAAC;IACD,OAAO,GAAG,CAAC;AACb,CAAC","sourcesContent":["import { GlobalConfig } from '../../config/global';\n\nconst basicEnvVars = [\n  'HTTP_PROXY',\n  'HTTPS_PROXY',\n  'NO_PROXY',\n  'http_proxy',\n  'https_proxy',\n  'no_proxy',\n  'HOME',\n  'PATH',\n  'LC_ALL',\n  'LANG',\n  'DOCKER_HOST',\n  'DOCKER_TLS_VERIFY',\n  'DOCKER_CERT_PATH',\n  // Custom certificte variables\n  // https://github.com/containerbase/base/blob/main/docs/custom-root-ca.md\n  'SSL_CERT_DIR',\n  'SSL_CERT_FILE',\n  'NODE_EXTRA_CA_CERTS',\n  // Required for NuGet to work on Windows.\n  'PROGRAMFILES',\n  'PROGRAMFILES(X86)',\n  'APPDATA',\n  'LOCALAPPDATA',\n  // Corepack: https://github.com/nodejs/corepack\n  'COREPACK_DEFAULT_TO_LATEST',\n  'COREPACK_ENABLE_NETWORK',\n  'COREPACK_ENABLE_STRICT',\n  'COREPACK_ENABLE_PROJECT_SPEC',\n  'COREPACK_ENABLE_UNSAFE_CUSTOM_URLS',\n  'COREPACK_HOME',\n  'COREPACK_INTEGRITY_KEYS',\n  'COREPACK_NPM_REGISTRY',\n  'COREPACK_NPM_TOKEN',\n  'COREPACK_NPM_USERNAME',\n  'COREPACK_NPM_PASSWORD',\n  'COREPACK_ROOT',\n];\n\nexport function getChildProcessEnv(\n  customEnvVars: string[] = [],\n): NodeJS.ProcessEnv {\n  const env: NodeJS.ProcessEnv = {};\n  if (GlobalConfig.get('exposeAllEnv')) {\n    return { ...process.env };\n  }\n  const envVars = [...basicEnvVars, ...customEnvVars];\n  envVars.forEach((envVar) => {\n    if (typeof process.env[envVar] !== 'undefined') {\n      env[envVar] = process.env[envVar];\n    }\n  });\n\n  // Copy containerbase url replacements\n  for (const key of Object.keys(process.env)) {\n    if (/^URL_REPLACE_\\d+_(?:FROM|TO)$/.test(key)) {\n      env[key] = process.env[key];\n    }\n  }\n  return env;\n}\n"]}