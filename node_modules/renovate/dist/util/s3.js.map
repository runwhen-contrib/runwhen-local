{"version":3,"file":"s3.js","sourceRoot":"","sources":["../../lib/util/s3.ts"],"names":[],"mappings":";;AAOA,kCAgBC;AAOD,gCAYC;;AA1CD,+CAA+C;AAC/C,kDAA8C;AAC9C,kEAAkC;AAClC,6CAAgD;AAChD,+BAAiC;AAEjC,IAAI,UAAgC,CAAC;AACrC,SAAgB,WAAW;AACzB,mEAAmE;AACnE,UAAmB,EACnB,WAAqB;IAErB,IAAI,CAAC,UAAU,EAAE,CAAC;QAChB,MAAM,QAAQ,GAAG,UAAU,IAAI,qBAAY,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;QAC9D,MAAM,cAAc,GAAG,YAAE,CAAC,SAAS,CAAC,WAAW,CAAC;YAC9C,CAAC,CAAC,CAAC,CAAC,qBAAY,CAAC,GAAG,CAAC,aAAa,CAAC;YACnC,CAAC,CAAC,WAAW,CAAC;QAChB,UAAU,GAAG,IAAI,oBAAQ,CAAC;YACxB,GAAG,CAAC,QAAQ,IAAI,EAAE,QAAQ,EAAE,CAAC;YAC7B,GAAG,CAAC,cAAc,IAAI,EAAE,cAAc,EAAE,IAAI,EAAE,CAAC;SAChD,CAAC,CAAC;IACL,CAAC;IACD,OAAO,UAAU,CAAC;AACpB,CAAC;AAOD,SAAgB,UAAU,CAAC,MAAoB;IAC7C,MAAM,SAAS,GAAG,OAAO,MAAM,KAAK,QAAQ,CAAC,CAAC,CAAC,IAAA,cAAQ,EAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;IACzE,IAAI,SAAS,KAAK,IAAI,EAAE,CAAC;QACvB,OAAO,IAAI,CAAC;IACd,CAAC;IACD,IAAI,SAAS,CAAC,QAAQ,KAAK,KAAK,EAAE,CAAC;QACjC,OAAO,IAAI,CAAC;IACd,CAAC;IACD,OAAO;QACL,MAAM,EAAE,SAAS,CAAC,IAAI;QACtB,GAAG,EAAE,SAAS,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC;KACrC,CAAC;AACJ,CAAC","sourcesContent":["// Singleton S3 instance initialized on-demand.\nimport { S3Client } from '@aws-sdk/client-s3';\nimport is from '@sindresorhus/is';\nimport { GlobalConfig } from '../config/global';\nimport { parseUrl } from './url';\n\nlet s3Instance: S3Client | undefined;\nexport function getS3Client(\n  // Only needed if GlobalConfig is not initialized due to some error\n  s3Endpoint?: string,\n  s3PathStyle?: boolean,\n): S3Client {\n  if (!s3Instance) {\n    const endpoint = s3Endpoint ?? GlobalConfig.get('s3Endpoint');\n    const forcePathStyle = is.undefined(s3PathStyle)\n      ? !!GlobalConfig.get('s3PathStyle')\n      : s3PathStyle;\n    s3Instance = new S3Client({\n      ...(endpoint && { endpoint }),\n      ...(forcePathStyle && { forcePathStyle: true }),\n    });\n  }\n  return s3Instance;\n}\n\nexport interface S3UrlParts {\n  Bucket: string;\n  Key: string;\n}\n\nexport function parseS3Url(rawUrl: URL | string): S3UrlParts | null {\n  const parsedUrl = typeof rawUrl === 'string' ? parseUrl(rawUrl) : rawUrl;\n  if (parsedUrl === null) {\n    return null;\n  }\n  if (parsedUrl.protocol !== 's3:') {\n    return null;\n  }\n  return {\n    Bucket: parsedUrl.host,\n    Key: parsedUrl.pathname.substring(1),\n  };\n}\n"]}