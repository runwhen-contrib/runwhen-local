{"version":3,"file":"author.js","sourceRoot":"","sources":["../../../lib/util/git/author.ts"],"names":[],"mappings":";;AAKA,wCAwCC;;AA7CD,8EAAoC;AACpC,yCAAsC;AACtC,oCAAiC;AAGjC,SAAgB,cAAc,CAAC,KAAa;IAC1C,IAAI,MAAM,GAAqB,IAAI,CAAC;IACpC,IAAI,CAAC,KAAK,EAAE,CAAC;QACX,OAAO,IAAI,CAAC;IACd,CAAC;IACD,IAAI,CAAC;QACH,MAAM,GAAG,yBAAK,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;QACtC,IAAI,MAAM,EAAE,CAAC;YACX,OAAO,MAAM,CAAC;QAChB,CAAC;QACD,IAAI,aAAiC,CAAC;QACtC,IAAI,gBAAgB,GAAG,KAAK,CAAC;QAC7B,IAAI,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC;YAC/C,2CAA2C;YAC3C,aAAa,GAAG,GAAG,GAAG,KAAK,CAAC,OAAO,CAAC,IAAA,aAAK,EAAC,QAAQ,CAAC,EAAE,KAAK,CAAC,CAAC;QAC9D,CAAC;QACD,IAAI,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC;YAC7B,mCAAmC;YACnC,aAAa,GAAG,CAAC,aAAa,IAAI,KAAK,CAAC,CAAC,OAAO,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC;YAChE,gBAAgB,GAAG,IAAI,CAAC;QAC1B,CAAC;QACD,IAAI,CAAC,aAAa,EAAE,CAAC;YACnB,OAAO,IAAI,CAAC;QACd,CAAC;QACD,MAAM,MAAM,GAAG,yBAAK,CAAC,eAAe,CAAC,aAAa,CAAwB,CAAC;QAC3E,IAAI,MAAM,EAAE,OAAO,EAAE,CAAC;YACpB,MAAM,GAAG;gBACP,IAAI,EAAE,MAAM,CAAC,IAAI,IAAI,KAAK,CAAC,OAAO,CAAC,IAAA,aAAK,EAAC,KAAK,CAAC,EAAE,EAAE,CAAC;gBACpD,OAAO,EAAE,MAAM,CAAC,OAAO;aACxB,CAAC;YACF,IAAI,gBAAgB,EAAE,CAAC;gBACrB,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC,OAAO,EAAE,OAAO,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;YAC1D,CAAC;YACD,OAAO,MAAM,CAAC;QAChB,CAAC;IACH,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACb,eAAM,CAAC,KAAK,CAAC,EAAE,GAAG,EAAE,EAAE,iCAAiC,CAAC,CAAC;IAC3D,CAAC;IACD,UAAU;IACV,OAAO,IAAI,CAAC;AACd,CAAC","sourcesContent":["import addrs from 'email-addresses';\nimport { logger } from '../../logger';\nimport { regEx } from '../regex';\nimport type { GitAuthor } from './types';\n\nexport function parseGitAuthor(input: string): GitAuthor | null {\n  let result: GitAuthor | null = null;\n  if (!input) {\n    return null;\n  }\n  try {\n    result = addrs.parseOneAddress(input);\n    if (result) {\n      return result;\n    }\n    let massagedInput: string | undefined;\n    let massagedBotEmail = false;\n    if (input.includes('<') && input.includes('>')) {\n      // try wrapping the name part in quotations\n      massagedInput = '\"' + input.replace(regEx(/(\\s?<)/), '\"$1');\n    }\n    if (input.includes('[bot]@')) {\n      // invalid github app/bot addresses\n      massagedInput = (massagedInput ?? input).replace('[bot]@', '@');\n      massagedBotEmail = true;\n    }\n    if (!massagedInput) {\n      return null;\n    }\n    const parsed = addrs.parseOneAddress(massagedInput) as addrs.ParsedMailbox;\n    if (parsed?.address) {\n      result = {\n        name: parsed.name ?? input.replace(regEx(/@.*/), ''),\n        address: parsed.address,\n      };\n      if (massagedBotEmail) {\n        result.address = result.address?.replace('@', '[bot]@');\n      }\n      return result;\n    }\n  } catch (err) {\n    logger.debug({ err }, 'Unknown error parsing gitAuthor');\n  }\n  // give up\n  return null;\n}\n"]}