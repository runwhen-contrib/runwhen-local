{"version":3,"file":"extract.js","sourceRoot":"","sources":["../../../../lib/modules/manager/pub/extract.ts"],"names":[],"mappings":"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","sourcesContent":["import is from '@sindresorhus/is';\nimport type { SkipReason } from '../../../types';\nimport { DartDatasource } from '../../datasource/dart';\nimport { DartVersionDatasource } from '../../datasource/dart-version';\nimport { FlutterVersionDatasource } from '../../datasource/flutter-version';\nimport type { PackageDependency, PackageFileContent } from '../types';\nimport type { PubspecSchema } from './schema';\nimport { parsePubspec } from './utils';\n\nfunction extractFromSection(\n  pubspec: PubspecSchema,\n  sectionKey: keyof Pick<PubspecSchema, 'dependencies' | 'dev_dependencies'>,\n): PackageDependency[] {\n  const sectionContent = pubspec[sectionKey];\n  if (!sectionContent) {\n    return [];\n  }\n\n  const skippedPackages = [\n    'flutter_driver',\n    'flutter_localizations',\n    'flutter_test',\n    'flutter_web_plugins',\n    'meta',\n  ];\n  const deps: PackageDependency[] = [];\n  for (const depName of Object.keys(sectionContent)) {\n    if (skippedPackages.includes(depName)) {\n      continue;\n    }\n\n    let currentValue = sectionContent[depName];\n    let skipReason: SkipReason | undefined;\n    let registryUrls: string[] | undefined;\n\n    if (!is.string(currentValue)) {\n      const version = currentValue.version;\n      const path = currentValue.path;\n      const hosted = currentValue.hosted;\n\n      if (is.string(hosted)) {\n        registryUrls = [hosted];\n      } else if (is.string(hosted?.url)) {\n        registryUrls = [hosted.url];\n      }\n\n      if (version) {\n        currentValue = version;\n      } else if (path) {\n        currentValue = '';\n        skipReason = 'path-dependency';\n      } else {\n        currentValue = '';\n      }\n    }\n\n    deps.push({\n      depName,\n      depType: sectionKey,\n      currentValue,\n      datasource: DartDatasource.id,\n      ...(registryUrls && { registryUrls }),\n      skipReason,\n    });\n  }\n\n  return deps;\n}\n\nfunction extractDart(pubspec: PubspecSchema): PackageDependency[] {\n  return [\n    {\n      depName: 'dart',\n      currentValue: pubspec.environment.sdk,\n      datasource: DartVersionDatasource.id,\n    },\n  ];\n}\n\nfunction extractFlutter(pubspec: PubspecSchema): PackageDependency[] {\n  const currentValue = pubspec.environment.flutter;\n  if (!currentValue) {\n    return [];\n  }\n\n  return [\n    {\n      depName: 'flutter',\n      currentValue,\n      datasource: FlutterVersionDatasource.id,\n    },\n  ];\n}\n\nexport function extractPackageFile(\n  content: string,\n  packageFile: string,\n): PackageFileContent | null {\n  const pubspec = parsePubspec(packageFile, content);\n  if (!pubspec) {\n    return null;\n  }\n\n  return {\n    deps: [\n      ...extractFromSection(pubspec, 'dependencies'),\n      ...extractFromSection(pubspec, 'dev_dependencies'),\n      ...extractDart(pubspec),\n      ...extractFlutter(pubspec),\n    ],\n  };\n}\n"]}