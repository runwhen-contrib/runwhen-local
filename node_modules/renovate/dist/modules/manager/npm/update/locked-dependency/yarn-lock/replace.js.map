{"version":3,"file":"replace.js","sourceRoot":"","sources":["../../../../../../../lib/modules/manager/npm/update/locked-dependency/yarn-lock/replace.ts"],"names":[],"mappings":";;AAGA,4DAoCC;AAvCD,qDAAkD;AAClD,wDAAqD;AAErD,SAAgB,wBAAwB,CACtC,eAAuB,EACvB,OAAe,EACf,UAAkB,EAClB,UAAkB,EAClB,aAAsB;IAEtB,IAAI,eAAe,CAAC,UAAU,CAAC,aAAa,CAAC,EAAE,CAAC;QAC9C,UAAU;QACV,OAAO,eAAe,CAAC;IACzB,CAAC;IACD,MAAM,iBAAiB,GAAG,GAAG,OAAO,IAAI,UAAU,EAAE,CAAC;IACrD,MAAM,OAAO,GAAG,iBAAiB,CAAC,OAAO,CAAC,kBAAkB,EAAE,MAAM,CAAC,CAAC;IACtE,MAAM,WAAW,GAAG,IAAI,OAAO,2DAA2D,CAAC;IAC3F,sCAAsC;IACtC,MAAM,WAAW,GAAG,IAAA,aAAK,EAAC,WAAW,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;IAC7D,qBAAqB;IACrB,IAAI,CAAC,WAAW,EAAE,CAAC;QACjB,eAAM,CAAC,KAAK,CACV,EAAE,OAAO,EAAE,UAAU,EAAE,UAAU,EAAE,EACnC,wCAAwC,CACzC,CAAC;QACF,OAAO,eAAe,CAAC;IACzB,CAAC;IACD,IAAI,cAAc,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC;IACpC,IAAI,aAAa,EAAE,CAAC;QAClB,MAAM,oBAAoB,GAAG,GAAG,OAAO,IAAI,aAAa,EAAE,CAAC;QAC3D,cAAc,GAAG,cAAc,CAAC,OAAO,CACrC,iBAAiB,EACjB,oBAAoB,CACrB,CAAC;IACJ,CAAC;IACD,OAAO,eAAe,CAAC,OAAO,CAC5B,IAAA,aAAK,EAAC,WAAW,CAAC,EAClB,GAAG,cAAc,cAAc,UAAU,OAAO,CACjD,CAAC;AACJ,CAAC","sourcesContent":["import { logger } from '../../../../../../logger';\nimport { regEx } from '../../../../../../util/regex';\n\nexport function replaceConstraintVersion(\n  lockFileContent: string,\n  depName: string,\n  constraint: string,\n  newVersion: string,\n  newConstraint?: string,\n): string {\n  if (lockFileContent.startsWith('__metadata:')) {\n    // Yarn 2+\n    return lockFileContent;\n  }\n  const depNameConstraint = `${depName}@${constraint}`;\n  const escaped = depNameConstraint.replace(/(@|\\^|\\.|\\\\|\\|)/g, '\\\\$1');\n  const matchString = `(${escaped}((\"|\",|,)[^\\n:]*)?:\\n)(.*\\n)*?(\\\\s+dependencies|\\n[@a-z])`;\n  // yarn will fill in the details later\n  const matchResult = regEx(matchString).exec(lockFileContent);\n  // istanbul ignore if\n  if (!matchResult) {\n    logger.debug(\n      { depName, constraint, newVersion },\n      'Could not find constraint in lock file',\n    );\n    return lockFileContent;\n  }\n  let constraintLine = matchResult[1];\n  if (newConstraint) {\n    const newDepNameConstraint = `${depName}@${newConstraint}`;\n    constraintLine = constraintLine.replace(\n      depNameConstraint,\n      newDepNameConstraint,\n    );\n  }\n  return lockFileContent.replace(\n    regEx(matchString),\n    `${constraintLine}  version \"${newVersion}\"\\n$5`,\n  );\n}\n"]}