{"version":3,"file":"extract.js","sourceRoot":"","sources":["../../../../lib/modules/manager/gradle/extract.ts"],"names":[],"mappings":"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","sourcesContent":["import upath from 'upath';\nimport { logger } from '../../../logger';\nimport { coerceArray } from '../../../util/array';\nimport { getLocalFiles } from '../../../util/fs';\nimport { regEx } from '../../../util/regex';\nimport { MavenDatasource } from '../../datasource/maven';\nimport gradleVersioning from '../../versioning/gradle';\nimport type { ExtractConfig, PackageDependency, PackageFile } from '../types';\nimport { parseCatalog } from './extract/catalog';\nimport {\n  isGcvPropsFile,\n  parseGcv,\n  usesGcv,\n} from './extract/consistent-versions-plugin';\nimport { parseGradle, parseKotlinSource, parseProps } from './parser';\nimport { REGISTRY_URLS } from './parser/common';\nimport type {\n  ContentDescriptorSpec,\n  GradleManagerData,\n  PackageRegistry,\n  VariableRegistry,\n} from './types';\nimport {\n  getVars,\n  isGradleScriptFile,\n  isKotlinSourceFile,\n  isPropsFile,\n  isTOMLFile,\n  reorderFiles,\n  toAbsolutePath,\n  updateVars,\n} from './utils';\n\nconst mavenDatasource = MavenDatasource.id;\n\nfunction updatePackageRegistries(\n  packageRegistries: PackageRegistry[],\n  urls: PackageRegistry[],\n): void {\n  for (const url of urls) {\n    const registryAlreadyKnown = packageRegistries.some(\n      (item) =>\n        item.registryUrl === url.registryUrl && item.scope === url.scope,\n    );\n    if (!registryAlreadyKnown) {\n      packageRegistries.push(url);\n    }\n  }\n}\n\nexport function matchesContentDescriptor(\n  dep: PackageDependency<GradleManagerData>,\n  contentDescriptors?: ContentDescriptorSpec[],\n): boolean {\n  const [groupId, artifactId] = (dep.packageName ?? dep.depName!).split(':');\n  let hasIncludes = false;\n  let hasExcludes = false;\n  let matchesInclude = false;\n  let matchesExclude = false;\n\n  for (const content of coerceArray(contentDescriptors)) {\n    const {\n      mode,\n      matcher,\n      groupId: contentGroupId,\n      artifactId: contentArtifactId,\n      version: contentVersion,\n    } = content;\n\n    // group matching\n    let groupMatch = false;\n    if (matcher === 'regex') {\n      groupMatch = regEx(contentGroupId).test(groupId);\n    } else if (matcher === 'subgroup') {\n      groupMatch =\n        groupId === contentGroupId || `${groupId}.`.startsWith(contentGroupId);\n    } else {\n      groupMatch = groupId === contentGroupId;\n    }\n\n    // artifact matching (optional)\n    let artifactMatch = true;\n    if (groupMatch && contentArtifactId) {\n      if (matcher === 'regex') {\n        artifactMatch = regEx(contentArtifactId).test(artifactId);\n      } else {\n        artifactMatch = artifactId === contentArtifactId;\n      }\n    }\n\n    // version matching (optional)\n    let versionMatch = true;\n    if (groupMatch && artifactMatch && contentVersion && dep.currentValue) {\n      if (matcher === 'regex') {\n        versionMatch = regEx(contentVersion).test(dep.currentValue);\n      } else {\n        // contentVersion can be an exact version or a gradle-supported version range\n        versionMatch = gradleVersioning.matches(\n          dep.currentValue,\n          contentVersion,\n        );\n      }\n    }\n\n    const isMatch = groupMatch && artifactMatch && versionMatch;\n    if (mode === 'include') {\n      hasIncludes = true;\n      if (isMatch) {\n        matchesInclude = true;\n      }\n    } else if (mode === 'exclude') {\n      hasExcludes = true;\n      if (isMatch) {\n        matchesExclude = true;\n      }\n    }\n  }\n\n  if (hasIncludes && hasExcludes) {\n    // if both includes and excludes exist, dep must match include and not match exclude\n    return matchesInclude && !matchesExclude;\n  } else if (hasIncludes) {\n    // if only includes exist, dep must match at least one include\n    return matchesInclude;\n  } else if (hasExcludes) {\n    // if only excludes exist, dep must not match any exclude\n    return !matchesExclude;\n  }\n\n  // by default, repositories include everything and exclude nothing\n  return true;\n}\n\nfunction getRegistryUrlsForDep(\n  packageRegistries: PackageRegistry[],\n  dep: PackageDependency<GradleManagerData>,\n): string[] {\n  const scope = dep.depType === 'plugin' ? 'plugin' : 'dep';\n\n  const matchingRegistries = packageRegistries.filter(\n    (item) =>\n      item.scope === scope && matchesContentDescriptor(dep, item.content),\n  );\n\n  const exclusiveRegistries = matchingRegistries.filter(\n    (item) => item.registryType === 'exclusive',\n  );\n\n  const registryUrls = (\n    exclusiveRegistries.length ? exclusiveRegistries : matchingRegistries\n  ).map((item) => item.registryUrl);\n\n  if (!registryUrls.length && scope === 'plugin') {\n    registryUrls.push(REGISTRY_URLS.gradlePluginPortal);\n  }\n\n  return [...new Set(registryUrls)];\n}\n\nasync function parsePackageFiles(\n  config: ExtractConfig,\n  packageFiles: string[],\n  extractedDeps: PackageDependency<GradleManagerData>[],\n  packageFilesByName: Record<string, PackageFile>,\n  packageRegistries: PackageRegistry[],\n): Promise<PackageDependency<GradleManagerData>[]> {\n  const varRegistry: VariableRegistry = {};\n  const fileContents = await getLocalFiles(packageFiles);\n\n  for (const packageFile of packageFiles) {\n    packageFilesByName[packageFile] = {\n      packageFile,\n      datasource: mavenDatasource,\n      deps: [],\n    };\n\n    try {\n      // TODO #22198\n      const content = fileContents[packageFile]!;\n      const packageFileDir = upath.dirname(toAbsolutePath(packageFile));\n\n      if (isPropsFile(packageFile)) {\n        const { vars, deps } = parseProps(content, packageFile);\n        updateVars(varRegistry, packageFileDir, vars);\n        extractedDeps.push(...deps);\n      } else if (isTOMLFile(packageFile)) {\n        const deps = parseCatalog(packageFile, content);\n        extractedDeps.push(...deps);\n      } else if (\n        isGcvPropsFile(packageFile) &&\n        usesGcv(packageFile, fileContents)\n      ) {\n        const deps = parseGcv(packageFile, fileContents);\n        extractedDeps.push(...deps);\n      } else if (isKotlinSourceFile(packageFile)) {\n        const vars = getVars(varRegistry, packageFileDir);\n        const { vars: gradleVars, deps } = parseKotlinSource(\n          content,\n          vars,\n          packageFile,\n        );\n        updateVars(varRegistry, '/', gradleVars);\n        extractedDeps.push(...deps);\n      } else if (isGradleScriptFile(packageFile)) {\n        const vars = getVars(varRegistry, packageFileDir);\n        const {\n          deps,\n          urls,\n          vars: gradleVars,\n        } = parseGradle(content, vars, packageFile, fileContents);\n        updatePackageRegistries(packageRegistries, urls);\n        updateVars(varRegistry, packageFileDir, gradleVars);\n        extractedDeps.push(...deps);\n      }\n    } catch (err) {\n      logger.debug(\n        { err, config, packageFile },\n        `Failed to process Gradle file`,\n      );\n    }\n  }\n\n  return extractedDeps;\n}\n\nexport async function extractAllPackageFiles(\n  config: ExtractConfig,\n  packageFiles: string[],\n): Promise<PackageFile[] | null> {\n  const packageFilesByName: Record<string, PackageFile> = {};\n  const packageRegistries: PackageRegistry[] = [];\n  const extractedDeps: PackageDependency<GradleManagerData>[] = [];\n  const kotlinSourceFiles = packageFiles.filter(isKotlinSourceFile);\n  const gradleFiles = reorderFiles(\n    packageFiles.filter((e) => !kotlinSourceFiles.includes(e)),\n  );\n\n  await parsePackageFiles(\n    config,\n    [...kotlinSourceFiles, ...kotlinSourceFiles, ...gradleFiles],\n    extractedDeps,\n    packageFilesByName,\n    packageRegistries,\n  );\n\n  if (!extractedDeps.length) {\n    return null;\n  }\n\n  for (const dep of extractedDeps) {\n    dep.fileReplacePosition = dep?.managerData?.fileReplacePosition; // #8224\n\n    const key = dep.managerData?.packageFile;\n    // istanbul ignore else\n    if (key) {\n      let pkgFile: PackageFile = packageFilesByName[key];\n      // istanbul ignore if: won't happen if \"apply from\" processes only initially known files\n      if (!pkgFile) {\n        pkgFile = {\n          packageFile: key,\n          datasource: mavenDatasource,\n          deps: [],\n        };\n      }\n\n      dep.datasource ??= mavenDatasource;\n\n      if (dep.datasource === mavenDatasource) {\n        dep.registryUrls = getRegistryUrlsForDep(packageRegistries, dep);\n\n        dep.depType ??=\n          key.startsWith('buildSrc') && !kotlinSourceFiles.length\n            ? 'devDependencies'\n            : 'dependencies';\n      }\n\n      const depAlreadyInPkgFile = pkgFile.deps.some(\n        (item) =>\n          item.depName === dep.depName &&\n          item.managerData?.fileReplacePosition ===\n            dep.managerData?.fileReplacePosition,\n      );\n      if (!depAlreadyInPkgFile) {\n        pkgFile.deps.push(dep);\n      }\n\n      packageFilesByName[key] = pkgFile;\n    } else {\n      logger.debug({ dep }, `Failed to process Gradle dependency`);\n    }\n  }\n\n  return Object.values(packageFilesByName);\n}\n"]}