{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../../lib/modules/manager/gitlabci/utils.ts"],"names":[],"mappings":";;AAaA,oCAYC;AAzBD,+CAA4C;AAC5C,mDAA+C;AAG/C,MAAM,UAAU,GAAG,IAAA,aAAK,EACtB,yFAAyF,CAC1F,CAAC;AAEF;;;;GAIG;AACH,SAAgB,YAAY,CAC1B,SAAiB,EACjB,eAAwC;IAExC,MAAM,KAAK,GAAG,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;IACzC,IAAI,KAAK,EAAE,MAAM,EAAE,CAAC;QAClB,MAAM,GAAG,GAAG,EAAE,GAAG,IAAA,gBAAM,EAAC,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,aAAa,EAAE,SAAS,EAAE,CAAC;QAC1E,uBAAuB;QACvB,GAAG,CAAC,yBAAyB,GAAG,GAAG,KAAK,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,CAAC,yBAAyB,EAAE,CAAC;QACzF,OAAO,GAAG,CAAC;IACb,CAAC;IACD,OAAO,IAAA,gBAAM,EAAC,SAAS,EAAE,IAAI,EAAE,eAAe,CAAC,CAAC;AAClD,CAAC","sourcesContent":["import { regEx } from '../../../util/regex';\nimport { getDep } from '../dockerfile/extract';\nimport type { PackageDependency } from '../types';\n\nconst depProxyRe = regEx(\n  `(?<prefix>\\\\$\\\\{?CI_DEPENDENCY_PROXY_(?:DIRECT_)?GROUP_IMAGE_PREFIX\\\\}?/)(?<depName>.+)`,\n);\n\n/**\n * Get image dependencies respecting Gitlab Dependency Proxy\n * @param imageName as used in .gitlab-ci.yml file\n * @return package dependency for the image\n */\nexport function getGitlabDep(\n  imageName: string,\n  registryAliases?: Record<string, string>,\n): PackageDependency {\n  const match = depProxyRe.exec(imageName);\n  if (match?.groups) {\n    const dep = { ...getDep(match.groups.depName), replaceString: imageName };\n    // TODO: types (#22198)\n    dep.autoReplaceStringTemplate = `${match.groups.prefix}${dep.autoReplaceStringTemplate}`;\n    return dep;\n  }\n  return getDep(imageName, true, registryAliases);\n}\n"]}