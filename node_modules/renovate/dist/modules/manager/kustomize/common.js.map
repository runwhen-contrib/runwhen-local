{"version":3,"file":"common.js","sourceRoot":"","sources":["../../../../lib/modules/manager/kustomize/common.ts"],"names":[],"mappings":";;AAMA,4CAkBC;;AAxBD,4DAA4B;AAC5B,0DAA0B;AAE1B,yCAAmD;AAGnD,SAAgB,gBAAgB,CAAC,MAA6B;IAC5D,MAAM,QAAQ,GAAG,IAAA,oBAAe,GAAE,CAAC;IAEnC,MAAM,IAAI,GAAa;QACrB,iGAAiG;QACjG,oBAAoB,EAAE,eAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,eAAe,CAAC;QAC3D,sBAAsB,EAAE,eAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,mBAAmB,CAAC;QACjE,qBAAqB,EAAE,eAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,cAAc,CAAC;KAC5D,CAAC;IAEF,IACE,MAAM,CAAC,WAAW,EAAE,IAAI;QACxB,CAAC,gBAAM,CAAC,UAAU,CAAC,MAAM,CAAC,WAAW,CAAC,IAAI,EAAE,SAAS,CAAC,EACtD,CAAC;QACD,IAAI,CAAC,qBAAqB,GAAG,GAAG,CAAC;IACnC,CAAC;IAED,OAAO,IAAI,CAAC;AACd,CAAC","sourcesContent":["import semver from 'semver';\nimport upath from 'upath';\nimport type { ExtraEnv } from '../../../util/exec/types';\nimport { privateCacheDir } from '../../../util/fs';\nimport type { UpdateArtifactsConfig } from '../types';\n\nexport function generateHelmEnvs(config: UpdateArtifactsConfig): ExtraEnv {\n  const cacheDir = privateCacheDir();\n\n  const envs: ExtraEnv = {\n    // set cache and config files to a path in privateCacheDir to prevent file and credential leakage\n    HELM_REGISTRY_CONFIG: upath.join(cacheDir, 'registry.json'),\n    HELM_REPOSITORY_CONFIG: upath.join(cacheDir, 'repositories.yaml'),\n    HELM_REPOSITORY_CACHE: upath.join(cacheDir, 'repositories'),\n  };\n\n  if (\n    config.constraints?.helm &&\n    !semver.intersects(config.constraints.helm, '>=3.8.0')\n  ) {\n    envs.HELM_EXPERIMENTAL_OCI = '1';\n  }\n\n  return envs;\n}\n"]}