{"version":3,"file":"schema.js","sourceRoot":"","sources":["../../../../lib/modules/manager/gitlabci-include/schema.ts"],"names":[],"mappings":";;;AAAA,6BAAwB;AACxB,+CAA8C;AAC9C,6DAAwD;AACxD,8DAAoE;AAGpE,MAAM,aAAa,GAAG,OAAC;KACpB,MAAM,CAAC;IACN,OAAO,EAAE,OAAC,CAAC,MAAM,EAAE;IACnB,GAAG,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC;CAC5C,CAAC;KACD,SAAS,CAAC,CAAC,EAAE,OAAO,EAAE,GAAG,EAAE,EAAE,EAAE;IAC9B,MAAM,GAAG,GAAsB;QAC7B,UAAU,EAAE,kCAAoB,CAAC,EAAE;QACnC,OAAO,EAAE,OAAO;QAChB,OAAO,EAAE,YAAY;KACtB,CAAC;IAEF,IAAI,CAAC,GAAG,EAAE,CAAC;QACT,GAAG,CAAC,UAAU,GAAG,qBAAqB,CAAC;QACvC,OAAO,GAAG,CAAC;IACb,CAAC;IAED,GAAG,CAAC,YAAY,GAAG,GAAG,CAAC;IACvB,OAAO,GAAG,CAAC;AACb,CAAC,CAAC,CAAC;AAEL,MAAM,cAAc,GAAG,OAAC;KACrB,KAAK,CAAC,CAAC,aAAa,CAAC,SAAS,CAAC,eAAO,CAAC,EAAE,IAAA,yBAAU,EAAC,aAAa,CAAC,CAAC,CAAC;KACpE,KAAK,CAAC,EAAE,CAAC,CAAC;AAEb,MAAM,YAAY,GAAG,OAAC,CAAC,MAAM,CAAC,OAAC,CAAC,OAAO,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,GAAG,EAAE,EAAE;IAC3D,MAAM,EAAE,OAAO,EAAE,GAAG,IAAI,EAAE,GAAG,GAAG,CAAC;IACjC,MAAM,QAAQ,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IACrC,OAAO,EAAE,OAAO,EAAE,QAAQ,EAAE,CAAC;AAC/B,CAAC,CAAC,CAAC;AAEU,QAAA,cAAc,GAAG,OAAC;KAC5B,KAAK,CAAC,CAAC,YAAY,CAAC,SAAS,CAAC,eAAO,CAAC,EAAE,IAAA,yBAAU,EAAC,YAAY,CAAC,CAAC,CAAC;KAClE,SAAS,CAAC,CAAC,IAAI,EAAuB,EAAE,CACvC,IAAI;KACD,GAAG,CAAC,CAAC,EAAE,OAAO,EAAE,QAAQ,EAAE,EAAE,EAAE;IAC7B,MAAM,IAAI,GAAG,cAAc,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;IAC3C,MAAM,YAAY,GAAG,2BAAmB,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;IACzD,OAAO,CAAC,GAAG,YAAY,EAAE,GAAG,IAAI,CAAC,CAAC;AACpC,CAAC,CAAC;KACD,IAAI,EAAE,CACV,CAAC;AAES,QAAA,mBAAmB,GAAG,IAAA,yBAAU,EAAC,sBAAc,CAAC;KAC1D,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;KAC1B,KAAK,CAAC,EAAE,CAAC,CAAC","sourcesContent":["import { z } from 'zod';\nimport { toArray } from '../../../util/array';\nimport { LooseArray } from '../../../util/schema-utils';\nimport { GitlabTagsDatasource } from '../../datasource/gitlab-tags';\nimport type { PackageDependency } from '../types';\n\nconst GitlabInclude = z\n  .object({\n    project: z.string(),\n    ref: z.string().optional().catch(undefined),\n  })\n  .transform(({ project, ref }) => {\n    const dep: PackageDependency = {\n      datasource: GitlabTagsDatasource.id,\n      depName: project,\n      depType: 'repository',\n    };\n\n    if (!ref) {\n      dep.skipReason = 'unspecified-version';\n      return dep;\n    }\n\n    dep.currentValue = ref;\n    return dep;\n  });\n\nconst GitlabIncludes = z\n  .union([GitlabInclude.transform(toArray), LooseArray(GitlabInclude)])\n  .catch([]);\n\nconst GitlabRecord = z.record(z.unknown()).transform((obj) => {\n  const { include, ...rest } = obj;\n  const children = Object.values(rest);\n  return { include, children };\n});\n\nexport const GitlabDocument = z\n  .union([GitlabRecord.transform(toArray), LooseArray(GitlabRecord)])\n  .transform((docs): PackageDependency[] =>\n    docs\n      .map(({ include, children }) => {\n        const deps = GitlabIncludes.parse(include);\n        const childrenDeps = GitlabDocumentArray.parse(children);\n        return [...childrenDeps, ...deps];\n      })\n      .flat(),\n  );\n\nexport const GitlabDocumentArray = LooseArray(GitlabDocument)\n  .transform((x) => x.flat())\n  .catch([]);\n"]}