{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../../lib/modules/manager/helmfile/utils.ts"],"names":[],"mappings":";;AAWA,wDAMC;AAID,0EAQC;AAED,sCAEC;AAED,4DAeC;;AAlDD,0DAA0B;AAE1B,yCAAiE;AACjE,4EAAsD;AACtD,oDAA2D;AAC3D,6CAAoD;AAKpD,2EAA2E;AAC3E,SAAgB,sBAAsB,CAAC,OAAoB;IACzD,OAAO,CACL,OAAO,CAAC,qBAAqB,KAAK,SAAS;QAC3C,OAAO,CAAC,WAAW,KAAK,SAAS;QACjC,OAAO,CAAC,YAAY,KAAK,SAAS,CACnC,CAAC;AACJ,CAAC;AAED,4FAA4F;AAC5F,yCAAyC;AAClC,KAAK,UAAU,+BAA+B,CACnD,OAAoB,EACpB,oBAA4B;IAE5B,MAAM,qBAAqB,GAAG,IAAA,iBAAY,EAAC,oBAAoB,CAAC,IAAI,EAAE,CAAC;IACvE,OAAO,IAAA,oBAAe,EACpB,eAAK,CAAC,IAAI,CAAC,qBAAqB,EAAE,OAAO,CAAC,KAAK,EAAE,oBAAoB,CAAC,CACvE,CAAC;AACJ,CAAC;AAED,SAAgB,aAAa,CAAC,UAA0B;IACtD,OAAO,UAAU,CAAC,GAAG,KAAK,IAAI,CAAC;AACjC,CAAC;AAEM,KAAK,UAAU,wBAAwB,CAC5C,cAAsB,EACtB,iBAAyB,EACzB,cAAsB;IAEtB,MAAM,cAAc,GAAmB;QACrC,IAAI,EAAE,cAAc;QACpB,UAAU,EAAE,cAAc;QAC1B,QAAQ,EAAE,SAAS,CAAC,IAAI,CAAC;YACvB,GAAG,EAAE,iBAAiB;YACtB,QAAQ,EAAE,yBAAgB,CAAC,EAAE;SAC9B,CAAC;KACH,CAAC;IAEF,OAAO,MAAM,IAAA,yBAAgB,EAAC,cAAc,EAAE,qBAAqB,CAAC,CAAC;AACvE,CAAC","sourcesContent":["import upath from 'upath';\n\nimport { getParentDir, localPathExists } from '../../../util/fs';\nimport * as hostRules from '../../../util/host-rules';\nimport { DockerDatasource } from '../../datasource/docker';\nimport { generateLoginCmd } from '../helmv3/common';\nimport type { RepositoryRule } from '../helmv3/types';\n\nimport type { HelmRelease, HelmRepository } from './schema';\n\n/** Returns true if a helmfile release contains kustomize specific keys **/\nexport function kustomizationsKeysUsed(release: HelmRelease): boolean {\n  return (\n    release.strategicMergePatches !== undefined ||\n    release.jsonPatches !== undefined ||\n    release.transformers !== undefined\n  );\n}\n\n/** Returns true if a helmfile release uses a local chart with a kustomization.yaml file **/\n// eslint-disable-next-line require-await\nexport async function localChartHasKustomizationsYaml(\n  release: HelmRelease,\n  helmFileYamlFileName: string,\n): Promise<boolean> {\n  const helmfileYamlParentDir = getParentDir(helmFileYamlFileName) || '';\n  return localPathExists(\n    upath.join(helmfileYamlParentDir, release.chart, 'kustomization.yaml'),\n  );\n}\n\nexport function isOCIRegistry(repository: HelmRepository): boolean {\n  return repository.oci === true;\n}\n\nexport async function generateRegistryLoginCmd(\n  repositoryName: string,\n  repositoryBaseURL: string,\n  repositoryHost: string,\n): Promise<string | null> {\n  const repositoryRule: RepositoryRule = {\n    name: repositoryName,\n    repository: repositoryHost,\n    hostRule: hostRules.find({\n      url: repositoryBaseURL,\n      hostType: DockerDatasource.id,\n    }),\n  };\n\n  return await generateLoginCmd(repositoryRule, 'helm registry login');\n}\n"]}