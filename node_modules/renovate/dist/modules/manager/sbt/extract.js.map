{"version":3,"file":"extract.js","sourceRoot":"","sources":["../../../../lib/modules/manager/sbt/extract.ts"],"names":[],"mappings":"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","sourcesContent":["import { lang, query as q } from 'good-enough-parser';\nimport { logger } from '../../../logger';\nimport { readLocalFile } from '../../../util/fs';\nimport { newlineRegex, regEx } from '../../../util/regex';\nimport { parseUrl } from '../../../util/url';\nimport { GithubReleasesDatasource } from '../../datasource/github-releases';\nimport { MavenDatasource } from '../../datasource/maven';\nimport { MAVEN_REPO } from '../../datasource/maven/common';\nimport { SbtPackageDatasource } from '../../datasource/sbt-package';\nimport {\n  SBT_PLUGINS_REPO,\n  SbtPluginDatasource,\n} from '../../datasource/sbt-plugin';\nimport { get } from '../../versioning';\nimport * as mavenVersioning from '../../versioning/maven';\nimport * as semverVersioning from '../../versioning/semver';\nimport type {\n  ExtractConfig,\n  PackageDependency,\n  PackageFile,\n  PackageFileContent,\n} from '../types';\nimport { normalizeScalaVersion, sortPackageFiles } from './util';\n\ntype Vars = Record<string, string>;\n\ninterface Ctx {\n  vars: Vars;\n  deps: PackageDependency[];\n  registryUrls: string[];\n\n  scalaVersion?: string;\n  packageFileVersion?: string;\n\n  groupId?: string;\n  artifactId?: string;\n  currentValue?: string;\n\n  currentVarName?: string;\n  depType?: string;\n  useScalaVersion?: boolean;\n  variableName?: string;\n}\n\nconst scala = lang.createLang('scala');\n\nconst sbtVersionRegex = regEx(\n  'sbt\\\\.version *= *(?<version>\\\\d+\\\\.\\\\d+\\\\.\\\\d+)',\n);\n\nconst sbtProxyUrlRegex = regEx(\n  /^\\s*(?<repoName>\\S+):\\s+(?<proxy>https?:\\/\\/[\\w./-]+)/,\n);\n\nconst scalaVersionMatch = q\n  .sym<Ctx>('scalaVersion')\n  .op(':=')\n  .alt(\n    q.str<Ctx>((ctx, { value: scalaVersion }) => ({ ...ctx, scalaVersion })),\n    q.sym<Ctx>((ctx, { value: varName }) => {\n      const scalaVersion = ctx.vars[varName];\n      if (scalaVersion) {\n        ctx.scalaVersion = scalaVersion;\n      }\n      return ctx;\n    }),\n  )\n  .handler((ctx) => {\n    if (ctx.scalaVersion) {\n      const version = get(mavenVersioning.id);\n\n      let packageName = 'org.scala-lang:scala-library';\n      if (version.getMajor(ctx.scalaVersion) === 3) {\n        packageName = 'org.scala-lang:scala3-library_3';\n      }\n\n      const dep: PackageDependency = {\n        datasource: MavenDatasource.id,\n        depName: 'scala',\n        packageName,\n        currentValue: ctx.scalaVersion,\n        separateMinorPatch: true,\n      };\n      ctx.scalaVersion = normalizeScalaVersion(ctx.scalaVersion);\n      ctx.deps.push(dep);\n    }\n    return ctx;\n  });\n\nconst packageFileVersionMatch = q\n  .sym<Ctx>('version')\n  .op(':=')\n  .alt(\n    q.str<Ctx>((ctx, { value: packageFileVersion }) => ({\n      ...ctx,\n      packageFileVersion,\n    })),\n    q.sym<Ctx>((ctx, { value: varName }) => {\n      const packageFileVersion = ctx.vars[varName];\n      if (packageFileVersion) {\n        ctx.packageFileVersion = packageFileVersion;\n      }\n      return ctx;\n    }),\n  );\n\nconst variableNameMatch = q\n  .sym<Ctx>((ctx, { value: varName }) => ({\n    ...ctx,\n    currentVarName: varName,\n  }))\n  .opt(q.op<Ctx>(':').sym('String'));\n\nconst variableValueMatch = q.str<Ctx>((ctx, { value }) => {\n  ctx.vars[ctx.currentVarName!] = value;\n  delete ctx.currentVarName;\n  return ctx;\n});\n\nconst assignmentMatch = q.sym<Ctx>('val').join(variableNameMatch).op('=');\n\nconst variableDefinitionMatch = q\n  .alt(\n    q.sym<Ctx>('lazy').join(assignmentMatch),\n    assignmentMatch,\n    variableNameMatch.op(':='),\n  )\n  .join(variableValueMatch);\n\nconst groupIdMatch = q.alt<Ctx>(\n  q.sym<Ctx>((ctx, { value: varName }) => {\n    const currentGroupId = ctx.vars[varName];\n    if (currentGroupId) {\n      ctx.groupId = currentGroupId;\n    }\n    return ctx;\n  }),\n  q.str<Ctx>((ctx, { value: groupId }) => ({ ...ctx, groupId })),\n);\n\nconst artifactIdMatch = q.alt<Ctx>(\n  q.sym<Ctx>((ctx, { value: varName }) => {\n    const artifactId = ctx.vars[varName];\n    if (artifactId) {\n      ctx.artifactId = artifactId;\n    }\n    return ctx;\n  }),\n  q.str<Ctx>((ctx, { value: artifactId }) => ({ ...ctx, artifactId })),\n);\n\nconst versionMatch = q.alt<Ctx>(\n  q.sym<Ctx>((ctx, { value: varName }) => {\n    const currentValue = ctx.vars[varName];\n    if (currentValue) {\n      ctx.currentValue = currentValue;\n      ctx.variableName = varName;\n    }\n    return ctx;\n  }),\n  q.str<Ctx>((ctx, { value: currentValue }) => ({ ...ctx, currentValue })),\n);\n\nconst simpleDependencyMatch = groupIdMatch\n  .op('%')\n  .join(artifactIdMatch)\n  .op('%')\n  .join(versionMatch);\n\nconst versionedDependencyMatch = groupIdMatch\n  .op('%%')\n  .join(artifactIdMatch)\n  .handler((ctx) => ({ ...ctx, useScalaVersion: true }))\n  .op('%')\n  .join(versionMatch);\n\nconst crossDependencyMatch = groupIdMatch\n  .op('%%%')\n  .join(artifactIdMatch)\n  .handler((ctx) => ({ ...ctx, useScalaVersion: true }))\n  .op('%')\n  .join(versionMatch);\n\nfunction depHandler(ctx: Ctx): Ctx {\n  const {\n    scalaVersion,\n    groupId,\n    artifactId,\n    currentValue,\n    useScalaVersion,\n    depType,\n    variableName,\n  } = ctx;\n\n  delete ctx.groupId;\n  delete ctx.artifactId;\n  delete ctx.currentValue;\n  delete ctx.useScalaVersion;\n  delete ctx.depType;\n  delete ctx.variableName;\n\n  const depName = `${groupId!}:${artifactId!}`;\n\n  const dep: PackageDependency = {\n    datasource: SbtPackageDatasource.id,\n    depName,\n    packageName:\n      scalaVersion && useScalaVersion ? `${depName}_${scalaVersion}` : depName,\n    currentValue,\n  };\n\n  if (depType) {\n    dep.depType = depType;\n  }\n\n  if (depType === 'plugin') {\n    dep.datasource = SbtPluginDatasource.id;\n  }\n\n  if (variableName) {\n    dep.sharedVariableName = variableName;\n    dep.variableName = variableName;\n  }\n\n  ctx.deps.push(dep);\n\n  return ctx;\n}\n\nfunction depTypeHandler(ctx: Ctx, { value: depType }: { value: string }): Ctx {\n  return { ...ctx, depType };\n}\n\nconst sbtPackageMatch = q\n  .opt<Ctx>(q.opt(q.sym<Ctx>('lazy')).sym('val').sym().op('='))\n  .alt(crossDependencyMatch, simpleDependencyMatch, versionedDependencyMatch)\n  .opt(\n    q.alt<Ctx>(\n      q.sym<Ctx>('classifier').str(depTypeHandler),\n      q.op<Ctx>('%').sym(depTypeHandler),\n      q.op<Ctx>('%').str(depTypeHandler),\n    ),\n  )\n  .handler(depHandler);\n\nconst sbtPluginMatch = q\n  .sym<Ctx>(regEx(/^(?:addSbtPlugin|addCompilerPlugin)$/))\n  .tree({\n    type: 'wrapped-tree',\n    maxDepth: 1,\n    search: q\n      .begin<Ctx>()\n      .alt(simpleDependencyMatch, versionedDependencyMatch)\n      .end(),\n  })\n  .handler((ctx) => ({ ...ctx, depType: 'plugin' }))\n  .handler(depHandler);\n\nconst resolverMatch = q\n  .str<Ctx>()\n  .sym('at')\n  .str((ctx, { value }) => {\n    if (parseUrl(value)) {\n      ctx.registryUrls.push(value);\n    }\n    return ctx;\n  });\n\nconst addResolverMatch = q.sym<Ctx>('resolvers').alt(\n  q.op<Ctx>('+=').join(resolverMatch),\n  q.op<Ctx>('++=').sym('Seq').tree({\n    type: 'wrapped-tree',\n    maxDepth: 1,\n    search: resolverMatch,\n  }),\n);\n\nfunction registryUrlHandler(ctx: Ctx): Ctx {\n  for (const dep of ctx.deps) {\n    dep.registryUrls = [...ctx.registryUrls];\n  }\n  return ctx;\n}\n\nconst query = q.tree<Ctx>({\n  type: 'root-tree',\n  maxDepth: 32,\n  search: q.alt<Ctx>(\n    scalaVersionMatch,\n    packageFileVersionMatch,\n    sbtPackageMatch,\n    sbtPluginMatch,\n    addResolverMatch,\n    variableDefinitionMatch,\n  ),\n  postHandler: registryUrlHandler,\n});\n\nexport function extractProxyUrls(\n  content: string,\n  packageFile: string,\n): string[] {\n  const extractedProxyUrls: string[] = [];\n  logger.debug(`Parsing proxy repository file ${packageFile}`);\n  for (const line of content.split(newlineRegex)) {\n    const extraction = sbtProxyUrlRegex.exec(line);\n    if (extraction?.groups?.proxy) {\n      extractedProxyUrls.push(extraction.groups.proxy);\n    } else if (line.trim() === 'maven-central') {\n      extractedProxyUrls.push(MAVEN_REPO);\n    }\n  }\n  return extractedProxyUrls;\n}\n\nexport function extractPackageFile(\n  content: string,\n  packageFile: string,\n): PackageFileContent | null {\n  return extractPackageFileInternal(content, packageFile);\n}\n\nfunction extractPackageFileInternal(\n  content: string,\n  packageFile: string,\n  ctxScalaVersion?: string,\n): PackageFileContent | null {\n  if (\n    packageFile === 'project/build.properties' ||\n    packageFile.endsWith('/project/build.properties')\n  ) {\n    const regexResult = sbtVersionRegex.exec(content);\n    const sbtVersion = regexResult?.groups?.version;\n    const matchString = regexResult?.[0];\n    if (sbtVersion) {\n      const sbtDependency: PackageDependency = {\n        datasource: GithubReleasesDatasource.id,\n        depName: 'sbt/sbt',\n        packageName: 'sbt/sbt',\n        versioning: semverVersioning.id,\n        currentValue: sbtVersion,\n        replaceString: matchString,\n        extractVersion: '^v(?<version>\\\\S+)',\n        registryUrls: [],\n      };\n\n      return {\n        deps: [sbtDependency],\n      };\n    } else {\n      return null;\n    }\n  }\n\n  let parsedResult: Ctx | null = null;\n\n  try {\n    parsedResult = scala.query(content, query, {\n      vars: {},\n      deps: [],\n      registryUrls: [],\n      scalaVersion: ctxScalaVersion,\n    });\n  } catch (err) /* istanbul ignore next */ {\n    logger.debug({ err, packageFile }, 'Sbt parsing error');\n  }\n\n  if (!parsedResult) {\n    return null;\n  }\n\n  const { deps, scalaVersion, packageFileVersion } = parsedResult;\n\n  if (!deps.length) {\n    return null;\n  }\n\n  return { deps, packageFileVersion, managerData: { scalaVersion } };\n}\n\nexport async function extractAllPackageFiles(\n  _config: ExtractConfig,\n  packageFiles: string[],\n): Promise<PackageFile[]> {\n  const packages: PackageFile[] = [];\n  const proxyUrls: string[] = [];\n  let ctxScalaVersion: string | undefined;\n\n  const sortedPackageFiles = sortPackageFiles(packageFiles);\n\n  for (const packageFile of sortedPackageFiles) {\n    const content = await readLocalFile(packageFile, 'utf8');\n    if (!content) {\n      logger.debug({ packageFile }, 'packageFile has no content');\n      continue;\n    }\n    if (packageFile === 'repositories') {\n      const urls = extractProxyUrls(content, packageFile);\n      proxyUrls.push(...urls);\n    } else {\n      const pkg = extractPackageFileInternal(\n        content,\n        packageFile,\n        ctxScalaVersion,\n      );\n      if (pkg) {\n        packages.push({ deps: pkg.deps, packageFile });\n        if (pkg.managerData?.scalaVersion) {\n          ctxScalaVersion = pkg.managerData.scalaVersion;\n        }\n      }\n    }\n  }\n  for (const pkg of packages) {\n    for (const dep of pkg.deps) {\n      if (dep.datasource !== GithubReleasesDatasource.id) {\n        if (proxyUrls.length > 0) {\n          dep.registryUrls!.unshift(...proxyUrls);\n        } else if (dep.depType === 'plugin') {\n          dep.registryUrls!.unshift(SBT_PLUGINS_REPO, MAVEN_REPO);\n        } else {\n          dep.registryUrls!.unshift(MAVEN_REPO);\n        }\n      }\n    }\n  }\n  return packages;\n}\n"]}