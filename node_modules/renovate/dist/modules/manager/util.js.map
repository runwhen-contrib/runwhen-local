{"version":3,"file":"util.js","sourceRoot":"","sources":["../../../lib/modules/manager/util.ts"],"names":[],"mappings":";;AAQA,wCAmCC;AA3CD,8CAAmD;AACnD,4CAAiD;AACjD,qDAA2D;AAC3D,qDAA2D;AAC3D,2DAAiE;AACjE,2DAAiE;AAGjE,SAAgB,cAAc,CAC5B,GAAsB,EACtB,GAAW,EACX,GAAuB,EACvB,GAAuB,EACvB,MAA0B;IAE1B,IAAI,GAAG,EAAE,CAAC;QACR,MAAM,QAAQ,GAAG,IAAA,uBAAc,EAAC,GAAG,CAAC,CAAC;QACrC,IAAI,QAAQ,KAAK,QAAQ,IAAI,QAAQ,KAAK,QAAQ,EAAE,CAAC;YACnD,GAAG,CAAC,UAAU;gBACZ,QAAQ,KAAK,QAAQ;oBACnB,CAAC,CAAC,kCAAoB,CAAC,EAAE;oBACzB,CAAC,CAAC,kCAAoB,CAAC,EAAE,CAAC;YAC9B,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,SAAS,EAAE,GAAG,IAAA,iBAAW,EAAC,GAAG,CAAC,CAAC;YACzD,GAAG,CAAC,YAAY,GAAG,CAAC,GAAG,QAAQ,MAAM,MAAM,EAAE,CAAC,CAAC;YAC/C,GAAG,CAAC,WAAW,GAAG,SAAS,CAAC;QAC9B,CAAC;aAAM,CAAC;YACN,GAAG,CAAC,UAAU,GAAG,4BAAiB,CAAC,EAAE,CAAC;YACtC,GAAG,CAAC,WAAW,GAAG,GAAG,CAAC;QACxB,CAAC;QACD,GAAG,CAAC,YAAY,GAAG,GAAG,CAAC;QACvB,GAAG,CAAC,UAAU,GAAG,SAAS,CAAC;IAC7B,CAAC;SAAM,IAAI,GAAG,EAAE,CAAC;QACf,GAAG,CAAC,UAAU,GAAG,4BAAiB,CAAC,EAAE,CAAC;QACtC,GAAG,CAAC,WAAW,GAAG,GAAG,CAAC;QACtB,GAAG,CAAC,aAAa,GAAG,GAAG,CAAC;QACxB,GAAG,CAAC,aAAa,GAAG,GAAG,CAAC;QACxB,GAAG,CAAC,UAAU,GAAG,SAAS,CAAC;IAC7B,CAAC;SAAM,CAAC;QACN,GAAG,CAAC,UAAU,GAAG,4BAAiB,CAAC,EAAE,CAAC;QACtC,GAAG,CAAC,WAAW,GAAG,GAAG,CAAC;QACtB,GAAG,CAAC,YAAY,GAAG,MAAM,CAAC;QAC1B,GAAG,CAAC,UAAU,GAAG,MAAM,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC,CAAC,qBAAqB,CAAC;IACrE,CAAC;AACH,CAAC","sourcesContent":["import { detectPlatform } from '../../util/common';\nimport { parseGitUrl } from '../../util/git/url';\nimport { GitRefsDatasource } from '../datasource/git-refs';\nimport { GitTagsDatasource } from '../datasource/git-tags';\nimport { GithubTagsDatasource } from '../datasource/github-tags';\nimport { GitlabTagsDatasource } from '../datasource/gitlab-tags';\nimport type { PackageDependency } from './types';\n\nexport function applyGitSource(\n  dep: PackageDependency,\n  git: string,\n  rev: string | undefined,\n  tag: string | undefined,\n  branch: string | undefined,\n): void {\n  if (tag) {\n    const platform = detectPlatform(git);\n    if (platform === 'github' || platform === 'gitlab') {\n      dep.datasource =\n        platform === 'github'\n          ? GithubTagsDatasource.id\n          : GitlabTagsDatasource.id;\n      const { protocol, source, full_name } = parseGitUrl(git);\n      dep.registryUrls = [`${protocol}://${source}`];\n      dep.packageName = full_name;\n    } else {\n      dep.datasource = GitTagsDatasource.id;\n      dep.packageName = git;\n    }\n    dep.currentValue = tag;\n    dep.skipReason = undefined;\n  } else if (rev) {\n    dep.datasource = GitRefsDatasource.id;\n    dep.packageName = git;\n    dep.currentDigest = rev;\n    dep.replaceString = rev;\n    dep.skipReason = undefined;\n  } else {\n    dep.datasource = GitRefsDatasource.id;\n    dep.packageName = git;\n    dep.currentValue = branch;\n    dep.skipReason = branch ? 'git-dependency' : 'unspecified-version';\n  }\n}\n"]}