{"version":3,"file":"fragments.js","sourceRoot":"","sources":["../../../../../lib/modules/manager/bazel-module/parser/fragments.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from 'zod';\nimport { LooseArray, LooseRecord } from '../../../../util/schema-utils';\nimport * as starlark from './starlark';\n\nexport const StringFragmentSchema = z.object({\n  type: z.literal('string'),\n  value: z.string(),\n  isComplete: z.literal(true),\n});\nexport const BooleanFragmentSchema = z.object({\n  type: z.literal('boolean'),\n  value: z.boolean(),\n  isComplete: z.literal(true),\n});\nconst PrimitiveFragmentsSchema = z.discriminatedUnion('type', [\n  StringFragmentSchema,\n  BooleanFragmentSchema,\n]);\nexport const ArrayFragmentSchema = z.object({\n  type: z.literal('array'),\n  items: LooseArray(PrimitiveFragmentsSchema),\n  isComplete: z.boolean(),\n});\nexport const StringArrayFragmentSchema = z.object({\n  type: z.literal('array'),\n  items: LooseArray(StringFragmentSchema),\n  isComplete: z.boolean(),\n});\nconst ValueFragmentsSchema = z.discriminatedUnion('type', [\n  StringFragmentSchema,\n  BooleanFragmentSchema,\n  ArrayFragmentSchema,\n]);\nexport const RuleFragmentSchema = z.object({\n  type: z.literal('rule'),\n  rule: z.string(),\n  children: LooseRecord(ValueFragmentsSchema),\n  isComplete: z.boolean(),\n});\nexport const PreparedExtensionTagFragmentSchema = z.object({\n  type: z.literal('preparedExtensionTag'),\n  // See ExtensionTagFragmentSchema for documentation of the fields.\n  extension: z.string(),\n  rawExtension: z.string(),\n  offset: z.number(), // start offset in the source string\n  isComplete: z.literal(false), // never complete, parser internal type.\n});\nexport const ExtensionTagFragmentSchema = z.object({\n  type: z.literal('extensionTag'),\n  // The \"logical\" name of the extension (e.g. `oci` or `maven`).\n  extension: z.string(),\n  // The \"raw\" name of the extension as it appears in the MODULE file (e.g. `maven_01` or `maven`)\n  rawExtension: z.string(),\n  tag: z.string(),\n  children: LooseRecord(ValueFragmentsSchema),\n  isComplete: z.boolean(),\n  offset: z.number(), // start offset in the source string\n  rawString: z.string().optional(), // raw source string\n});\nexport const AttributeFragmentSchema = z.object({\n  type: z.literal('attribute'),\n  name: z.string(),\n  value: ValueFragmentsSchema.optional(),\n  isComplete: z.boolean(),\n});\nexport const AllFragmentsSchema = z.discriminatedUnion('type', [\n  ArrayFragmentSchema,\n  AttributeFragmentSchema,\n  BooleanFragmentSchema,\n  RuleFragmentSchema,\n  PreparedExtensionTagFragmentSchema,\n  ExtensionTagFragmentSchema,\n  StringFragmentSchema,\n]);\n\nexport type AllFragments = z.infer<typeof AllFragmentsSchema>;\nexport type ArrayFragment = z.infer<typeof ArrayFragmentSchema>;\nexport type AttributeFragment = z.infer<typeof AttributeFragmentSchema>;\nexport type BooleanFragment = z.infer<typeof BooleanFragmentSchema>;\nexport type ChildFragments = Record<string, ValueFragments>;\nexport type PrimitiveFragments = z.infer<typeof PrimitiveFragmentsSchema>;\nexport type RuleFragment = z.infer<typeof RuleFragmentSchema>;\nexport type PreparedExtensionTagFragment = z.infer<\n  typeof PreparedExtensionTagFragmentSchema\n>;\nexport type ExtensionTagFragment = z.infer<typeof ExtensionTagFragmentSchema>;\nexport type StringFragment = z.infer<typeof StringFragmentSchema>;\nexport type ValueFragments = z.infer<typeof ValueFragmentsSchema>;\nexport type ResultFragment = RuleFragment | ExtensionTagFragment;\n\nexport function string(value: string): StringFragment {\n  return {\n    type: 'string',\n    isComplete: true,\n    value,\n  };\n}\n\nexport function boolean(value: string | boolean): BooleanFragment {\n  return {\n    type: 'boolean',\n    isComplete: true,\n    value: typeof value === 'string' ? starlark.asBoolean(value) : value,\n  };\n}\n\nexport function rule(\n  rule: string,\n  children: ChildFragments = {},\n  isComplete = false,\n): RuleFragment {\n  return {\n    type: 'rule',\n    rule,\n    isComplete,\n    children,\n  };\n}\n\nexport function preparedExtensionTag(\n  extension: string,\n  rawExtension: string,\n  offset: number,\n): PreparedExtensionTagFragment {\n  return {\n    type: 'preparedExtensionTag',\n    extension,\n    rawExtension,\n    offset,\n    isComplete: false, // never complete\n  };\n}\n\nexport function extensionTag(\n  extension: string,\n  rawExtension: string,\n  tag: string,\n  offset: number,\n  children: ChildFragments = {},\n  rawString?: string,\n  isComplete = false,\n): ExtensionTagFragment {\n  return {\n    type: 'extensionTag',\n    extension,\n    rawExtension,\n    tag,\n    offset,\n    rawString,\n    isComplete,\n    children,\n  };\n}\n\nexport function attribute(\n  name: string,\n  value?: ValueFragments,\n  isComplete = false,\n): AttributeFragment {\n  return {\n    type: 'attribute',\n    name,\n    value,\n    isComplete,\n  };\n}\n\nexport function array(\n  items: PrimitiveFragments[] = [],\n  isComplete = false,\n): ArrayFragment {\n  return {\n    type: 'array',\n    items,\n    isComplete,\n  };\n}\n\nexport function isValue(data: unknown): data is ValueFragments {\n  const result = ValueFragmentsSchema.safeParse(data);\n  return result.success;\n}\n\nexport function isPrimitive(data: unknown): data is PrimitiveFragments {\n  const result = PrimitiveFragmentsSchema.safeParse(data);\n  return result.success;\n}\n"]}