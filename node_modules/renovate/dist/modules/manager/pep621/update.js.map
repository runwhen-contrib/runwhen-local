{"version":3,"file":"update.js","sourceRoot":"","sources":["../../../../lib/modules/manager/pep621/update.ts"],"names":[],"mappings":";;AAMA,gDAyCC;AA/CD,gDAA0C;AAE1C,4CAAyC;AACzC,+CAA4C;AAG5C,SAAgB,kBAAkB,CAChC,OAAe,EACf,YAAoB,EACpB,WAAwB;IAExB,eAAM,CAAC,KAAK,CACV,EAAE,WAAW,EAAE,YAAY,EAAE,EAC7B,mDAAmD,CACpD,CAAC;IAEF,IAAI,aAAa,GAAG,OAAO,CAAC;IAC5B,IAAI,CAAC;QACH,MAAM,iBAAiB,GAAG,IAAA,YAAG,EAAC,YAAY,EAAE,WAAW,CAAC,CAAC;QACzD,IAAI,CAAC,iBAAiB,EAAE,CAAC;YACvB,MAAM,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAC;QACvC,CAAC;QAED,eAAM,CAAC,KAAK,CAAC,sBAAsB,iBAAiB,EAAE,CAAC,CAAC;QACxD,aAAa,GAAG,OAAO,CAAC,OAAO,CAC7B,IAAA,aAAK,EAAC,+CAA+C,EAAE,GAAG,CAAC,EAC3D,aAAa,iBAAiB,EAAE,CACjC,CAAC;QAEF,IAAI,aAAa,KAAK,OAAO,EAAE,CAAC;YAC9B,eAAM,CAAC,KAAK,CAAC,4BAA4B,CAAC,CAAC;QAC7C,CAAC;aAAM,CAAC;YACN,eAAM,CAAC,KAAK,CAAC,+BAA+B,CAAC,CAAC;QAChD,CAAC;IACH,CAAC;IAAC,MAAM,CAAC;QACP,eAAM,CAAC,IAAI,CACT;YACE,OAAO;YACP,YAAY;YACZ,WAAW;YACX,OAAO,EAAE,QAAQ;SAClB,EACD,uBAAuB,CACxB,CAAC;IACJ,CAAC;IAED,OAAO,EAAE,aAAa,EAAE,CAAC;AAC3B,CAAC","sourcesContent":["import { inc } from '@renovatebot/pep440';\nimport type { ReleaseType } from 'semver';\nimport { logger } from '../../../logger';\nimport { regEx } from '../../../util/regex';\nimport type { BumpPackageVersionResult } from '../types';\n\nexport function bumpPackageVersion(\n  content: string,\n  currentValue: string,\n  bumpVersion: ReleaseType,\n): BumpPackageVersionResult {\n  logger.debug(\n    { bumpVersion, currentValue },\n    'Checking if we should bump pyproject.toml version',\n  );\n\n  let bumpedContent = content;\n  try {\n    const newProjectVersion = inc(currentValue, bumpVersion);\n    if (!newProjectVersion) {\n      throw new Error('pep440 inc failed');\n    }\n\n    logger.debug(`newProjectVersion: ${newProjectVersion}`);\n    bumpedContent = content.replace(\n      regEx(`^(?<version>version[ \\\\t]*=[ \\\\t]*['\"])[^'\"]*`, 'm'),\n      `$<version>${newProjectVersion}`,\n    );\n\n    if (bumpedContent === content) {\n      logger.debug('Version was already bumped');\n    } else {\n      logger.debug('Bumped pyproject.toml version');\n    }\n  } catch {\n    logger.warn(\n      {\n        content,\n        currentValue,\n        bumpVersion,\n        manager: 'pep621',\n      },\n      'Failed to bumpVersion',\n    );\n  }\n\n  return { bumpedContent };\n}\n"]}