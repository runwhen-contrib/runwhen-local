{"version":3,"file":"schema.js","sourceRoot":"","sources":["../../../../lib/modules/platform/github/schema.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from 'zod';\nimport { logger } from '../../../logger';\nimport { LooseArray } from '../../../util/schema-utils';\n\nconst PackageSchema = z.object({\n  ecosystem: z.union([\n    z.literal('maven'),\n    z.literal('npm'),\n    z.literal('nuget'),\n    z.literal('pip'),\n    z.literal('rubygems'),\n    z.literal('rust'),\n    z.literal('composer'),\n    z.literal('go'),\n  ]),\n  name: z.string(),\n});\n\nconst SecurityVulnerabilitySchema = z\n  .object({\n    first_patched_version: z.object({ identifier: z.string() }).nullish(),\n    package: PackageSchema,\n    vulnerable_version_range: z.string(),\n  })\n  .nullable();\n\nconst SecurityAdvisorySchema = z.object({\n  description: z.string(),\n  identifiers: z.array(\n    z.object({\n      type: z.string(),\n      value: z.string(),\n    }),\n  ),\n  references: z.array(z.object({ url: z.string() })).optional(),\n});\n\nexport const VulnerabilityAlertSchema = LooseArray(\n  z.object({\n    dismissed_reason: z.string().nullish(),\n    security_advisory: SecurityAdvisorySchema,\n    security_vulnerability: SecurityVulnerabilitySchema,\n    dependency: z.object({\n      manifest_path: z.string(),\n    }),\n  }),\n  {\n    /* v8 ignore start */\n    onError: ({ error }) => {\n      logger.debug(\n        { error },\n        'Vulnerability Alert: Failed to parse some alerts',\n      );\n    },\n    /* v8 ignore stop */\n  },\n);\n\n// https://docs.github.com/en/rest/repos/contents?apiVersion=2022-11-28#get-repository-content\nconst GithubResponseMetadata = z.object({\n  name: z.string(),\n  path: z.string(),\n});\n\nexport const GithubFileMeta = GithubResponseMetadata.extend({\n  type: z.literal('file'),\n});\nexport type GithubFileMeta = z.infer<typeof GithubFileMeta>;\n\nexport const GithubFile = GithubFileMeta.extend({\n  content: z.string(),\n  encoding: z.string(),\n});\nexport type GithubFile = z.infer<typeof GithubFile>;\n\nexport const GithubDirectory = GithubResponseMetadata.extend({\n  type: z.literal('dir'),\n});\n\nexport type GithubDirectory = z.infer<typeof GithubDirectory>;\n\nexport const GithubOtherContent = GithubResponseMetadata.extend({\n  type: z.literal('symlink').or(z.literal('submodule')),\n});\n\nexport type GithubOtherContent = z.infer<typeof GithubOtherContent>;\n\nexport const GithubElement = GithubFile.or(GithubFileMeta)\n  .or(GithubDirectory)\n  .or(GithubOtherContent);\nexport type GithubElement = z.infer<typeof GithubElement>;\n\nexport const GithubContentResponse = z.array(GithubElement).or(GithubElement);\n"]}