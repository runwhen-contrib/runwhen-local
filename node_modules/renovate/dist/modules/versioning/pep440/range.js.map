{"version":3,"file":"range.js","sourceRoot":"","sources":["../../../../lib/modules/versioning/pep440/range.ts"],"names":[],"mappings":"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","sourcesContent":["import { gte, lt, lte, satisfies } from '@renovatebot/pep440';\nimport { parse as parseRange } from '@renovatebot/pep440/lib/specifier.js';\nimport { parse as parseVersion } from '@renovatebot/pep440/lib/version.js';\nimport { logger } from '../../../logger';\nimport { coerceArray } from '../../../util/array';\nimport { regEx } from '../../../util/regex';\nimport type { NewValueConfig } from '../types';\n\nconst UserPolicyPrecisionMap = {\n  Major: 0,\n  Minor: 1,\n  Micro: 2,\n  Bug: 3,\n  None: Infinity,\n} as const;\nconst PrecisionUserPolicyMap = {\n  0: 'Major',\n  1: 'Minor',\n  2: 'Micro',\n  3: 'Bug',\n} as const;\n\ntype UserPolicy =\n  (typeof UserPolicyPrecisionMap)[keyof typeof UserPolicyPrecisionMap];\n\n/**\n * Calculate current update range precision.\n * @param ranges A {@link Range} consists of current range\n * @returns A {@link UserPolicy}\n */\nfunction getRangePrecision(ranges: Range[]): UserPolicy {\n  const bound = coerceArray(\n    parseVersion((ranges[1] || ranges[0]).version)?.release,\n  );\n  let rangePrecision = -1;\n  // range is defined by a single bound.\n  // ie. <1.2.2.3,\n  //     >=7\n  if (ranges.length === 1) {\n    rangePrecision = bound.length - 1;\n  }\n  // Range is defined by both upper and lower bounds.\n  if (ranges.length === 2) {\n    const lowerBound = coerceArray(parseVersion(ranges[0].version)?.release);\n    rangePrecision = bound.findIndex((el, index) => el > lowerBound[index]);\n  }\n  // Tune down Major precision if followed by a zero\n  if (\n    rangePrecision === UserPolicyPrecisionMap.Major &&\n    rangePrecision + 1 < bound.length &&\n    bound[rangePrecision + 1] === 0\n  ) {\n    rangePrecision++;\n  }\n  // Could not calculate user precision\n  // Default to the smallest possible\n  // istanbul ignore next\n  if (rangePrecision === -1) {\n    rangePrecision = bound.length - 1;\n  }\n  const key =\n    PrecisionUserPolicyMap[\n      rangePrecision as keyof typeof PrecisionUserPolicyMap\n    ];\n  return UserPolicyPrecisionMap[key as keyof typeof UserPolicyPrecisionMap];\n}\n\n/**\n * @param policy Required range precision\n * @param newVersion The newly accepted version\n * @param baseVersion Optional Current upper bound\n * @returns A string represents a future version upper bound.\n */\nfunction getFutureVersion(\n  policy: UserPolicy,\n  newVersion: string,\n  baseVersion?: string,\n): number[] {\n  const toRelease = coerceArray(parseVersion(newVersion)?.release);\n  const baseRelease = coerceArray(\n    parseVersion(baseVersion ?? newVersion)?.release,\n  );\n  return baseRelease.map((_, index) => {\n    const toPart = toRelease[index] ?? 0;\n    if (index < policy) {\n      return toPart;\n    }\n    if (index === policy) {\n      return toPart + (baseVersion === undefined ? 0 : 1);\n    }\n    return 0;\n  });\n}\n\ninterface Range {\n  operator: string;\n  prefix?: string;\n  version: string;\n}\n\nexport function getNewValue({\n  currentValue,\n  rangeStrategy,\n  currentVersion,\n  newVersion,\n  isReplacement,\n}: NewValueConfig): string | null {\n  let ranges: Range[];\n  let updatedRange: (string | null)[];\n  if (rangeStrategy === 'pin' && !isReplacement) {\n    return '==' + newVersion;\n  }\n\n  // no symbol: accept only that specific version specified\n  if (currentValue === currentVersion || isReplacement) {\n    return newVersion;\n  }\n\n  try {\n    ranges = parseCurrentRange(currentValue);\n    if (!ranges.length) {\n      // an empty string is an allowed value for PEP440 range\n      // it means get any version\n      logger.warn({ currentValue }, 'Empty currentValue');\n      return currentValue;\n    }\n  } catch (err) {\n    logger.warn({ currentValue, err }, 'Unexpected range error');\n    return null;\n  }\n\n  // return early if newVersion is excluded from range\n  if (\n    ranges.some(\n      (range) => range.operator === '!=' && range.version === newVersion,\n    )\n  ) {\n    logger.debug(\n      `Cannot calculate new value as the newVersion:\\`${newVersion}\\` is excluded from range: \\`${currentValue}\\``,\n    );\n    return null;\n  }\n\n  switch (rangeStrategy) {\n    case 'auto':\n    case 'replace':\n      updatedRange = handleReplaceStrategy(\n        {\n          currentValue,\n          rangeStrategy,\n          currentVersion,\n          newVersion,\n        },\n        ranges,\n      );\n      break;\n    case 'widen':\n      updatedRange = handleWidenStrategy(\n        {\n          currentValue,\n          rangeStrategy,\n          currentVersion,\n          newVersion,\n        },\n        ranges,\n      );\n      break;\n    case 'bump':\n      updatedRange = handleBumpStrategy(\n        {\n          currentValue,\n          rangeStrategy,\n          currentVersion,\n          newVersion,\n        },\n        ranges,\n      );\n      break;\n    default:\n      // Unsupported rangeStrategy\n      // Valid rangeStrategy values are: bump, extend, pin, replace.\n      // https://docs.renovatebot.com/modules/versioning/#pep440-versioning\n      logger.debug(\n        'Unsupported rangeStrategy: ' +\n          rangeStrategy +\n          '. Using \"replace\" instead.',\n      );\n      return getNewValue({\n        currentValue,\n        rangeStrategy: 'replace',\n        currentVersion,\n        newVersion,\n      });\n  }\n\n  let result = updatedRange.filter(Boolean).join(', ');\n\n  if (result.includes(', ') && !currentValue.includes(', ')) {\n    result = result.replace(regEx(/, /g), ',');\n  }\n  const checkedResult = checkRangeAndRemoveUnnecessaryRangeLimit(\n    result,\n    newVersion,\n  );\n\n  // istanbul ignore if\n  if (!satisfies(newVersion, checkedResult)) {\n    // we failed at creating the range\n    logger.warn(\n      { result, newVersion, currentValue },\n      'pep440: failed to calculate newValue',\n    );\n    return null;\n  }\n  return checkedResult;\n}\n\nexport function isLessThanRange(input: string, range: string): boolean {\n  try {\n    let invertResult = true;\n\n    const results = range\n      .split(',')\n      .map((x) =>\n        x\n          .replace(regEx(/\\s*/g), '')\n          .split(regEx(/(~=|==|!=|<=|>=|<|>|===)/))\n          .slice(1),\n      )\n      .map(([op, version]) => {\n        if (['!=', '<=', '<'].includes(op)) {\n          return true;\n        }\n        invertResult = false;\n        if (['~=', '==', '>=', '==='].includes(op)) {\n          return lt(input, version);\n        }\n        if (op === '>') {\n          return lte(input, version);\n        }\n        // istanbul ignore next\n        return false;\n      });\n\n    const result = results.every((res) => res === true);\n\n    return invertResult ? !result : result;\n  } catch /* istanbul ignore next */ {\n    return false;\n  }\n}\n\nfunction parseCurrentRange(currentValue: string): Range[] {\n  const ranges: Range[] = parseRange(currentValue);\n  if (!ranges) {\n    throw new TypeError('Invalid pep440 currentValue');\n  }\n  if (ranges.some((range) => range.operator === '===')) {\n    // the operator \"===\" is used for legacy non PEP440 versions\n    throw new TypeError('PEP440 arbitrary equality (===) not supported');\n  }\n  return ranges;\n}\n\nfunction handleLowerBound(range: Range, newVersion: string): string | null {\n  // used to mark minimum supported version\n  // lower the bound if the new version is lower than current range\n  if (['>', '>='].includes(range.operator)) {\n    if (lte(newVersion, range.version)) {\n      // this looks like a rollback\n      return '>=' + newVersion;\n    }\n    // otherwise, treat it same as exclude\n    return range.operator + range.version;\n  }\n  // istanbul ignore next\n  return null;\n}\n\nfunction handleUpperBound(range: Range, newVersion: string): string | null {\n  // this is used to exclude future versions\n  if (range.operator === '<') {\n    // if newVersion is that future version\n    if (gte(newVersion, range.version)) {\n      // now here things get tricky\n      // we calculate the new future version\n      const precision = getRangePrecision([range]);\n      const futureVersion = getFutureVersion(\n        precision,\n        newVersion,\n        range.version,\n      );\n      return range.operator + futureVersion.join('.');\n    }\n    // newVersion is in range, for other than \"replace\" strategies\n    return range.operator + range.version;\n  }\n  // istanbul ignore next\n  return null;\n}\n\nfunction updateRangeValue(\n  { currentValue, rangeStrategy, currentVersion, newVersion }: NewValueConfig,\n  range: Range,\n): string | null {\n  // used to exclude versions,\n  // we assume that's for a good reason\n  if (range.operator === '!=') {\n    return range.operator + range.version;\n  }\n\n  // keep the .* suffix\n  if (range.prefix) {\n    const futureVersion = getFutureVersion(\n      UserPolicyPrecisionMap.None,\n      newVersion,\n      range.version,\n    ).join('.');\n    return range.operator + futureVersion + '.*';\n  }\n  if (range.operator === '~=') {\n    const baseVersion = coerceArray(parseVersion(range.version)?.release);\n    const futureVersion = coerceArray(parseVersion(newVersion)?.release);\n    const baseLen = baseVersion.length;\n    const newVerLen = futureVersion.length;\n    // trim redundant trailing version specifiers\n    if (baseLen < newVerLen) {\n      return (\n        range.operator + futureVersion.slice(0, baseVersion.length).join('.')\n      );\n    }\n    // pad with specifiers\n    if (baseLen > newVerLen) {\n      for (let i = baseLen - newVerLen - 1; i >= 0; i--) {\n        futureVersion.push(0);\n      }\n      return range.operator + futureVersion.join('.');\n    }\n    return range.operator + newVersion;\n  }\n  if (['==', '<='].includes(range.operator)) {\n    if (lte(newVersion, range.version)) {\n      return range.operator + range.version;\n    }\n    return range.operator + newVersion;\n  }\n\n  let output = handleUpperBound(range, newVersion);\n  if (output) {\n    // manged to update upperbound\n    // no need to try anything else\n    return output;\n  }\n  output = handleLowerBound(range, newVersion);\n  if (output) {\n    return output;\n  }\n\n  // unless PEP440 changes, this won't happen\n  // istanbul ignore next\n  logger.error(\n    { newVersion, currentValue, range },\n    'pep440: failed to process range',\n  );\n  // istanbul ignore next\n  return null;\n}\n\n/**\n * Checks for zero specifiers.\n * returns true if one of the bounds' length is < 3.\n * @param ranges A {@link Range} array.\n * @returns A boolean value\n * Used mainly for cosmetics for the rez versioning syntax.\n */\nfunction hasZeroSpecifier(ranges: Range[]): boolean {\n  return ranges.some((range) => {\n    const release = parseVersion(range.version)?.release;\n    return release && release.length < 3;\n  });\n}\n\nfunction trimTrailingZeros(numbers: number[]): number[] {\n  let i = numbers.length - 1;\n  while (numbers[i] === 0) {\n    i--;\n  }\n  return numbers.slice(0, i + 1);\n}\n\nfunction divideCompatibleReleaseRange(currentRange: Range): Range[] {\n  const currentVersionUpperBound = currentRange.version\n    .split('.')\n    .map((num) => parseInt(num));\n  if (currentVersionUpperBound.length > 1) {\n    currentVersionUpperBound.splice(-1);\n  }\n  currentVersionUpperBound[currentVersionUpperBound.length - 1] += 1;\n  return [\n    { operator: '>=', version: currentRange.version },\n    {\n      operator: '<',\n      version: currentVersionUpperBound.join('.'),\n    },\n  ];\n}\n\nfunction handleWidenStrategy(\n  { currentValue, rangeStrategy, currentVersion, newVersion }: NewValueConfig,\n  ranges: Range[],\n): (string | null)[] {\n  // newVersion is within range\n  if (satisfies(newVersion, currentValue)) {\n    return [currentValue];\n  }\n  let rangePrecision = getRangePrecision(ranges);\n  const trimZeros = hasZeroSpecifier(ranges);\n  let newRanges: Range[] = [];\n  if (ranges.length === 1 && ranges[0].operator === '~=') {\n    // If range operator is '~=', divide the range into its logical equivalent.\n    // Example: ~=1.0 --> >=1.0,<2\n    newRanges = divideCompatibleReleaseRange(ranges[0]);\n  } else {\n    newRanges = ranges;\n  }\n  return newRanges.map((range) => {\n    // newVersion is over the upper bound\n    if (range.operator === '<' && gte(newVersion, range.version)) {\n      const upperBound = coerceArray(parseVersion(range.version)?.release);\n      const len = upperBound.length;\n      // Match the precision of the smallest specifier if other than 0\n      if (upperBound[len - 1] !== 0) {\n        const key =\n          PrecisionUserPolicyMap[\n            (len - 1) as keyof typeof PrecisionUserPolicyMap\n          ];\n        rangePrecision =\n          UserPolicyPrecisionMap[key as keyof typeof UserPolicyPrecisionMap];\n      }\n      let futureVersion = getFutureVersion(\n        rangePrecision,\n        newVersion,\n        range.version,\n      );\n      if (trimZeros) {\n        futureVersion = trimTrailingZeros(futureVersion);\n      }\n      return range.operator + futureVersion.join('.');\n    }\n    // default\n    return updateRangeValue(\n      {\n        currentValue,\n        rangeStrategy,\n        currentVersion,\n        newVersion,\n      },\n      range,\n    );\n  });\n}\n\nfunction handleReplaceStrategy(\n  { currentValue, rangeStrategy, currentVersion, newVersion }: NewValueConfig,\n  ranges: Range[],\n): (string | null)[] {\n  // newVersion is within range\n  if (satisfies(newVersion, currentValue)) {\n    return [currentValue];\n  }\n  const trimZeros = hasZeroSpecifier(ranges);\n  return ranges.map((range) => {\n    // newVersion is over the upper bound\n    if (range.operator === '<' && gte(newVersion, range.version)) {\n      const rangePrecision = getRangePrecision(ranges);\n      let futureVersion = getFutureVersion(\n        rangePrecision,\n        newVersion,\n        range.version,\n      );\n      if (trimZeros) {\n        futureVersion = trimTrailingZeros(futureVersion);\n      }\n      return range.operator + futureVersion.join('.');\n    }\n    // handle lower bound\n    if (['>', '>='].includes(range.operator)) {\n      if (lte(newVersion, range.version)) {\n        // this looks like a rollback\n        return '>=' + newVersion;\n      }\n      // update the lower bound to reflect the accepted new version\n      const lowerBound = coerceArray(parseVersion(range.version)?.release);\n      const rangePrecision = lowerBound.length - 1;\n      let newBase = getFutureVersion(rangePrecision, newVersion);\n      if (trimZeros) {\n        newBase = trimTrailingZeros(newBase);\n      }\n      // trim last element of the newBase when new accepted version is out of range.\n      // example: let new bound be >8.2.5 & newVersion be 8.2.5\n      // return value will be: >8.2\n      if (range.operator === '>') {\n        if (newVersion === newBase.join('.') && newBase.length > 1) {\n          newBase.pop();\n        }\n      }\n      return range.operator + newBase.join('.');\n    }\n    // default\n    return updateRangeValue(\n      {\n        currentValue,\n        rangeStrategy,\n        currentVersion,\n        newVersion,\n      },\n      range,\n    );\n  });\n}\n\nfunction handleBumpStrategy(\n  { currentValue, rangeStrategy, currentVersion, newVersion }: NewValueConfig,\n  ranges: Range[],\n): (string | null)[] {\n  return ranges.map((range) => {\n    // bump lower bound to current new version\n    if (range.operator === '>=') {\n      return range.operator + newVersion;\n    }\n    return updateRangeValue(\n      {\n        currentValue,\n        rangeStrategy,\n        currentVersion,\n        newVersion,\n      },\n      range,\n    );\n  });\n}\n\nexport function checkRangeAndRemoveUnnecessaryRangeLimit(\n  rangeInput: string,\n  newVersion: string,\n): string {\n  let newRange: string = rangeInput;\n  if (rangeInput.includes(',')) {\n    const newRes = rangeInput.split(',');\n    if (\n      newRes[0].includes('.*') &&\n      newRes[0].includes('==') &&\n      newRes[1].includes('>=')\n    ) {\n      if (satisfies(newVersion, newRes[0])) {\n        newRange = newRes[0];\n      }\n    }\n  } else {\n    return rangeInput;\n  }\n\n  return newRange;\n}\n"]}