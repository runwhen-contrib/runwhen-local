{"version":3,"file":"artifacts.js","sourceRoot":"","sources":["../../../../../lib/workers/repository/update/branch/artifacts.ts"],"names":[],"mappings":";;AAKA,wDAqCC;AA1CD,sDAAyD;AACzD,+CAA4C;AAC5C,2DAAwD;AAGjD,KAAK,UAAU,sBAAsB,CAC1C,MAAoB;IAEpB,IAAI,CAAC,MAAM,CAAC,cAAc,EAAE,MAAM,EAAE,CAAC;QACnC,YAAY;QACZ,OAAO;IACT,CAAC;IAED,MAAM,OAAO,GAAG,MAAM,CAAC,gBAAgB,EAAE,aAAa,CAAC;IACvD,IAAI,CAAC,OAAO,EAAE,CAAC;QACb,eAAM,CAAC,KAAK,CACV,0EAA0E,CAC3E,CAAC;QACF,OAAO;IACT,CAAC;IAED,MAAM,WAAW,GAAG,8BAA8B,CAAC;IACnD,MAAM,KAAK,GAAG,KAAK,CAAC;IACpB,MAAM,aAAa,GAAG,MAAM,mBAAQ,CAAC,oBAAoB,CACvD,MAAM,CAAC,UAAU,EACjB,OAAO,CACR,CAAC;IAEF,+BAA+B;IAC/B,IAAI,aAAa,KAAK,KAAK,EAAE,CAAC;QAC5B,eAAM,CAAC,KAAK,CAAC,uCAAuC,CAAC,CAAC;QACtD,IAAI,qBAAY,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE,CAAC;YAC/B,eAAM,CAAC,IAAI,CAAC,sCAAsC,GAAG,MAAM,CAAC,UAAU,CAAC,CAAC;QAC1E,CAAC;aAAM,CAAC;YACN,MAAM,mBAAQ,CAAC,eAAe,CAAC;gBAC7B,UAAU,EAAE,MAAM,CAAC,UAAU;gBAC7B,OAAO;gBACP,WAAW;gBACX,KAAK;aACN,CAAC,CAAC;QACL,CAAC;IACH,CAAC;AACH,CAAC","sourcesContent":["import { GlobalConfig } from '../../../../config/global';\nimport { logger } from '../../../../logger';\nimport { platform } from '../../../../modules/platform';\nimport type { BranchConfig } from '../../../types';\n\nexport async function setArtifactErrorStatus(\n  config: BranchConfig,\n): Promise<void> {\n  if (!config.artifactErrors?.length) {\n    // no errors\n    return;\n  }\n\n  const context = config.statusCheckNames?.artifactError;\n  if (!context) {\n    logger.debug(\n      'Status check is null or an empty string, skipping status check addition.',\n    );\n    return;\n  }\n\n  const description = 'Artifact file update failure';\n  const state = 'red';\n  const existingState = await platform.getBranchStatusCheck(\n    config.branchName,\n    context,\n  );\n\n  // Check if state needs setting\n  if (existingState !== state) {\n    logger.debug(`Updating status check state to failed`);\n    if (GlobalConfig.get('dryRun')) {\n      logger.info('DRY-RUN: Would set branch status in ' + config.branchName);\n    } else {\n      await platform.setBranchStatus({\n        branchName: config.branchName,\n        context,\n        description,\n        state,\n      });\n    }\n  }\n}\n"]}