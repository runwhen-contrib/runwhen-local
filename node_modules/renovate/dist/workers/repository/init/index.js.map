{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../lib/workers/repository/init/index.ts"],"names":[],"mappings":";;AA+CA,4BA+BC;;AA9ED,mDAAsD;AACtD,qDAA+D;AAE/D,4CAAyC;AACzC,iDAAoE;AACpE,wDAAqD;AACrD,6EAAuD;AACvD,+CAA4C;AAC5C,2CAAuE;AACvE,yDAAkD;AAClD,8CAAkD;AAClD,oDAAgD;AAEhD,iCAAkC;AAClC,mCAAwD;AACxD,qCAAyC;AACzC,mDAA4D;AAE5D,SAAS,gBAAgB,CAAC,MAAsB;IAC9C,OAAO;QACL,GAAG,IAAA,aAAK,EAAC,MAAM,CAAC;QAChB,MAAM,EAAE,EAAE;QACV,QAAQ,EAAE,EAAE;QACZ,UAAU,EAAE,EAAE;KACf,CAAC;AACJ,CAAC;AAED,SAAS,wBAAwB,CAAC,MAAsB;IACtD,IAAI,MAAM,CAAC,sBAAsB,IAAI,CAAC,mBAAQ,CAAC,sBAAsB,EAAE,CAAC;QACtE,uBAAuB;QACvB,MAAM,QAAQ,GAAG,qBAAY,CAAC,GAAG,CAAC,UAAU,CAAE,CAAC;QAC/C,eAAM,CAAC,IAAI,CACT,EAAE,QAAQ,EAAE,EACZ,yFAAyF,CAC1F,CAAC;IACJ,CAAC;IAED,IAAI,MAAM,CAAC,sBAAsB,IAAI,CAAC,mBAAQ,CAAC,kBAAkB,EAAE,CAAC;QAClE,uBAAuB;QACvB,MAAM,QAAQ,GAAG,qBAAY,CAAC,GAAG,CAAC,UAAU,CAAE,CAAC;QAC/C,eAAM,CAAC,IAAI,CACT,EAAE,QAAQ,EAAE,EACZ,yFAAyF,CAC1F,CAAC;IACJ,CAAC;AACH,CAAC;AAEM,KAAK,UAAU,QAAQ,CAC5B,OAAuB;IAEvB,4BAAY,CAAC,KAAK,EAAE,CAAC;IACrB,IAAI,MAAM,GAAmB,gBAAgB,CAAC,OAAO,CAAC,CAAC;IACvD,MAAM,IAAA,mBAAW,GAAE,CAAC;IACpB,eAAM,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;IACpB,QAAQ,CAAC,IAAI,EAAE,CAAC;IAChB,MAAM,GAAG,MAAM,IAAA,eAAQ,EAAC,MAAM,CAAC,CAAC;IAChC,MAAM,IAAA,wBAAgB,EAAC,MAA8B,CAAC,CAAC;IACvD,MAAM,GAAG,MAAM,IAAA,sBAAa,EAAC,MAAM,CAAC,CAAC;IACrC,IAAA,mCAA2B,EAAC,MAAM,CAAC,aAAa,CAAC,CAAC;IAClD,IAAI,MAAM,CAAC,IAAI,KAAK,QAAQ,EAAE,CAAC;QAC7B,eAAM,CAAC,IAAI,CACT,mFAAmF,CACpF,CAAC;IACJ,CAAC;IACD,IAAA,8BAAiB,EAAC,MAAM,CAAC,CAAC;IAC1B,wBAAwB,CAAC,MAAM,CAAC,CAAC;IACjC,MAAM,GAAG,IAAA,8BAAoB,EAAC,MAAM,CAAC,CAAC;IACtC,IAAA,uBAAiB,EAAC,MAAM,CAAC,CAAC;IAC1B,MAAM,GAAG,MAAM,IAAA,yCAAyB,EAAC,MAAM,CAAC,CAAC;IACjD,qBAAqB;IACrB,IAAI,MAAM,CAAC,WAAW,EAAE,CAAC;QACvB,eAAM,CAAC,IAAI,CACT,EAAE,MAAM,EAAE,SAAS,EAAE,IAAA,mBAAM,GAAE,EAAE,EAC/B,sDAAsD,CACvD,CAAC;IACJ,CAAC;IACD,MAAM,IAAA,qBAAe,EAAC,CAAC,CAAC,MAAM,CAAC,eAAe,EAAE,MAAM,CAAC,qBAAqB,CAAC,CAAC;IAC9E,OAAO,MAAM,CAAC;AAChB,CAAC","sourcesContent":["import { GlobalConfig } from '../../../config/global';\nimport { applySecretsToConfig } from '../../../config/secrets';\nimport type { RenovateConfig } from '../../../config/types';\nimport { logger } from '../../../logger';\nimport { setRepositoryLogLevelRemaps } from '../../../logger/remap';\nimport { platform } from '../../../modules/platform';\nimport * as memCache from '../../../util/cache/memory';\nimport { clone } from '../../../util/clone';\nimport { cloneSubmodules, setUserRepoConfig } from '../../../util/git';\nimport { getAll } from '../../../util/host-rules';\nimport { checkIfConfigured } from '../configured';\nimport { PackageFiles } from '../package-files';\nimport type { WorkerPlatformConfig } from './apis';\nimport { initApis } from './apis';\nimport { initializeCaches, resetCaches } from './cache';\nimport { getRepoConfig } from './config';\nimport { detectVulnerabilityAlerts } from './vulnerability';\n\nfunction initializeConfig(config: RenovateConfig): RenovateConfig {\n  return {\n    ...clone(config),\n    errors: [],\n    warnings: [],\n    branchList: [],\n  };\n}\n\nfunction warnOnUnsupportedOptions(config: RenovateConfig): void {\n  if (config.filterUnavailableUsers && !platform.filterUnavailableUsers) {\n    // TODO: types (#22198)\n    const platform = GlobalConfig.get('platform')!;\n    logger.warn(\n      { platform },\n      `Configuration option 'filterUnavailableUsers' is not supported on the current platform.`,\n    );\n  }\n\n  if (config.expandCodeOwnersGroups && !platform.expandGroupMembers) {\n    // TODO: types (#22198)\n    const platform = GlobalConfig.get('platform')!;\n    logger.warn(\n      { platform },\n      `Configuration option 'expandCodeOwnersGroups' is not supported on the current platform.`,\n    );\n  }\n}\n\nexport async function initRepo(\n  config_: RenovateConfig,\n): Promise<RenovateConfig> {\n  PackageFiles.clear();\n  let config: RenovateConfig = initializeConfig(config_);\n  await resetCaches();\n  logger.once.reset();\n  memCache.init();\n  config = await initApis(config);\n  await initializeCaches(config as WorkerPlatformConfig);\n  config = await getRepoConfig(config);\n  setRepositoryLogLevelRemaps(config.logLevelRemap);\n  if (config.mode === 'silent') {\n    logger.info(\n      'Repository is running with mode=silent and will not make Issues or PRs by default',\n    );\n  }\n  checkIfConfigured(config);\n  warnOnUnsupportedOptions(config);\n  config = applySecretsToConfig(config);\n  setUserRepoConfig(config);\n  config = await detectVulnerabilityAlerts(config);\n  // istanbul ignore if\n  if (config.printConfig) {\n    logger.info(\n      { config, hostRules: getAll() },\n      'Full resolved config and hostRules including presets',\n    );\n  }\n  await cloneSubmodules(!!config.cloneSubmodules, config.cloneSubmodulesFilter);\n  return config;\n}\n"]}